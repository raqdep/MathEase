        <!DOCTYPE html>                                                                                                                                                                                                                                                                                                                                                                                         
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - MathEase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        'slate': {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        'indigo': {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                        'emerald': {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        },
                        'violet': {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'scale-in': 'scaleIn 0.4s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="font-inter bg-slate-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200/60 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-xl flex items-center justify-center">
                        <img src="css/nav-logo/nav-logo.png" alt="MathEase Logo" class="h-6 w-6">
                    </div>
                    <span class="text-xl font-bold text-slate-800">MathEase</span>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-1">
                    <a href="dashboard.html" class="bg-indigo-50 text-indigo-600 font-medium px-4 py-2 rounded-lg text-sm transition-all duration-200">Dashboard</a>
                    <a href="#learning-path" id="topicsNavLink" class="text-slate-600 hover:text-slate-800 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">Topics</a>
                    <a href="quizzes.html" id="quizzesNavLink" class="text-slate-600 hover:text-slate-800 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">Quizzes</a>
                    <a href="achievements.html" id="achievementsNavLink" class="text-slate-600 hover:text-slate-800 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">Achievements</a>
                    <a href="dashboard.html#progress" id="progressNavLink" class="text-slate-600 hover:text-slate-800 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">Progress</a>
                </div>
                
                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <!-- Notifications -->
                    <div class="relative group">
                        <button onclick="toggleNotifications()" id="notificationButton" class="relative p-2 text-slate-600 hover:text-slate-800 hover:bg-slate-50 rounded-lg transition-all duration-200">
                            <i class="fas fa-bell text-lg"></i>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                        </button>
                        <div id="notificationsDropdown" class="absolute right-0 mt-2 w-80 bg-white/95 backdrop-blur-md rounded-xl shadow-xl border border-slate-200/60 py-2 z-50 opacity-0 invisible transition-all duration-200">
                            <div class="px-4 py-2 border-b border-slate-200/60">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <h3 class="text-sm font-semibold text-slate-800">Notifications</h3>
                                        <span id="dropdownNotificationCount" class="bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded-full font-medium">0</span>
                                    </div>
                                    <button onclick="markAllNotificationsAsRead()" class="text-xs text-indigo-600 hover:text-indigo-800 font-medium">Mark all read</button>
                                </div>
                            </div>
                            <div id="notificationsList" class="max-h-64 overflow-y-auto">
                                <!-- Notifications will be loaded here -->
                            </div>
                            <div class="px-4 py-2 border-t border-slate-200/60">
                                <a href="#" onclick="showAllNotifications()" class="text-xs text-indigo-600 hover:text-indigo-800 font-medium">View all notifications</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative group">
                        <button class="flex items-center space-x-2 text-slate-700 hover:text-slate-900 px-3 py-2 rounded-lg text-sm font-medium hover:bg-slate-50 transition-all duration-200">
                            <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-white text-xs"></i>
                            </div>
                            <span id="userName">Student</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div class="absolute right-0 mt-2 w-48 bg-white/95 backdrop-blur-md rounded-xl shadow-xl border border-slate-200/60 py-2 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                            <a href="#" onclick="confirmLogout(event)" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-colors" id="logoutLink">
                                <i class="fas fa-sign-out-alt mr-3 text-slate-400"></i>
                                Logout
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button type="button" class="text-slate-600 hover:text-slate-800 hover:bg-slate-50 p-2 rounded-lg transition-all duration-200">
                        <i class="fas fa-bars text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Teacher Lesson Management Section (Hidden by default) -->
    <div id="teacherLessonManagement" class="bg-white border-b border-gray-200 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-xl font-bold text-gray-900">Teacher Lesson Management</h2>
                    <p class="text-sm text-gray-600">Manage lesson access for your classes</p>
                </div>
                <button onclick="hideTeacherManagement()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <!-- Class Selector -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Class to Manage</label>
                <select id="teacherClassSelector" onchange="loadClassLessons()" class="w-full max-w-md px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">Choose a class...</option>
                </select>
            </div>
            
            <!-- Lesson Management -->
            <div id="lessonManagementContent" class="hidden">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Lesson Access Control</h3>
                <div id="lessonsList" class="space-y-3">
                    <!-- Lessons will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Header -->
    <div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white relative overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0">
            <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.05"%3E%3Ccircle cx="30" cy="30" r="1.5"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-60"></div>
            <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-transparent via-white/5 to-transparent transform -skew-y-1"></div>
        </div>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 relative">
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-start">
                <!-- Left Content - Welcome Text Only -->
                <div class="animate-fade-in hero-content">
                    <div class="mb-8">
                        <h1 class="text-5xl lg:text-6xl font-bold mb-6 bg-gradient-to-r from-white via-blue-100 to-purple-200 bg-clip-text text-transparent leading-tight">
                            Welcome back,<br>
                            <span id="welcomeName" class="text-yellow-300">Student</span>!
                </h1>
                        <p class="text-lg lg:text-xl text-blue-100 mb-8 leading-relaxed">
                            Master General Mathematics with interactive lessons, personalized progress tracking, and engaging virtual tools.
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="heroJoinClassBtn" onclick="openJoinClassModal()" class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-105 inline-flex items-center justify-center">
                                <i class="fas fa-users mr-3"></i>
                                Join Class
                            </button>
                            <a href="#progress" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white px-8 py-4 rounded-2xl font-bold text-lg border border-white/30 transition-all duration-300 inline-flex items-center justify-center">
                                <i class="fas fa-chart-line mr-3"></i>
                                View Progress
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Right Content - Cards and Welcome Character (Horizontal) -->
                <div class="animate-slide-up hero-cards">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 items-start">
                        <!-- Cards Column (Vertical) -->
                        <div class="space-y-4">
                            <!-- Lessons Card -->
                            <div class="bg-white/10 backdrop-blur-md rounded-3xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-500 group">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300 shadow-lg">
                                        <i class="fas fa-book-open text-xl text-white"></i>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-white" id="completedLessons">0</div>
                                        <div class="text-blue-200 text-sm">Lessons</div>
                                    </div>
                                </div>
                                <div class="text-white/80 text-xs">
                                    <i class="fas fa-arrow-up text-green-400 mr-1"></i>
                                    Complete lessons within each topic
                                </div>
                            </div>
                            
                            <!-- Badges Card -->
                            <div class="bg-white/10 backdrop-blur-md rounded-3xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-500 group">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300 shadow-lg">
                                        <i class="fas fa-medal text-xl text-white"></i>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-white" id="badgesEarned">0</div>
                                        <div class="text-purple-200 text-sm">Achievements</div>
                                    </div>
                                </div>
                                <div class="text-white/80 text-xs">
                                    <i class="fas fa-star text-yellow-400 mr-1"></i>
                                    Earn badges by completing quizzes
                                </div>
                            </div>
                        </div>
                        
                        <!-- Welcome Character Column -->
                        <div class="flex items-center justify-start">
                            <div class="welcome-character-container">
                                <img src="Img/Character/welcome-removebg-preview.png" 
                                     alt="Welcome Character" 
                                     id="welcomeCharacter"
                                     class="welcome-character">
                                <!-- Floating elements around the character -->
                                <div class="absolute -top-2 -right-2 w-6 h-6 bg-yellow-400 rounded-full animate-ping"></div>
                                <div class="absolute -bottom-2 -left-2 w-4 h-4 bg-green-400 rounded-full animate-pulse"></div>
                                <div class="absolute top-1/2 -right-4 w-3 h-3 bg-blue-400 rounded-full animate-bounce"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enrollment Status Banner -->
    <div id="enrollmentStatusBanner" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8">
        <!-- Enrollment status will be populated by JavaScript -->
    </div>

    <!-- Class Information Banner -->
    <div id="classInfoBanner" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 hidden">
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl p-6 shadow-lg">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-users text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-800" id="className">Class Information</h3>
                        <p class="text-sm text-slate-600" id="classDescription">You are enrolled in a class</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-slate-500">Teacher</div>
                    <div class="font-semibold text-slate-800" id="teacherName">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enrollment Gate (shown when NOT enrolled) -->
    <div id="enrollmentGate" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-8 hidden">
        <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/30 p-8 transition-all duration-500">
            <div class="flex items-start justify-between mb-6">
                <div class="flex items-start space-x-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-users text-white text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800 mb-1">Join a Class to Unlock Your Dashboard</h2>
                        <p class="text-slate-600">Join or request to join a class to access topics, quizzes, and progress tracking.</p>
                    </div>
                </div>
                <button onclick="openJoinClassModal()" class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-200 shadow-lg hover:shadow-xl">
                    <i class="fas fa-plus mr-2"></i>
                    Join Class
                </button>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-slate-800 mb-3">Your Class Requests</h3>
                <div id="enrollmentClassList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Filled by JS with pending/approved enrollments -->
                </div>
                <p id="noEnrollmentMsg" class="text-sm text-slate-500 mt-2 hidden">No class requests yet. Click “Join Class” and enter the code from your teacher.</p>
            </div>
        </div>
    </div>

    <!-- Dashboard Content (hidden until enrolled) -->
    <div id="dashboardMainContent" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="space-y-8">
                <!-- Progress Overview -->
                <div id="progress" class="bg-white/95 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/40 p-10 hover:shadow-3xl transition-all duration-500 animate-fade-in-up">
                    <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-10">
                        <div class="mb-6 lg:mb-0">
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg animate-float">
                                    <i class="fas fa-chart-line text-2xl text-white"></i>
                                </div>
                                <div>
                                    <h2 class="text-4xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">Your Progress</h2>
                                    <p class="text-lg text-slate-600">Track your learning journey and achievements</p>
                                </div>
                            </div>
                            <div id="lastSyncIndicator" class="text-sm text-slate-500 mt-2 hidden">
                                <i class="fas fa-sync-alt mr-2 text-indigo-500"></i>
                                Last updated: Never
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="progressManager.refresh()" 
                                    id="refreshButton"
                                    class="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-6 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center space-x-2 hover:scale-105 shadow-md hover:shadow-lg"
                                    title="Refresh progress data">
                                <i class="fas fa-sync-alt text-sm"></i>
                                <span>Refresh</span>
                            </button>
                            <button onclick="toggleAutoRefresh()" 
                                    id="autoRefreshToggle"
                                    class="bg-green-100 hover:bg-green-200 text-green-700 px-6 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center space-x-2 hover:scale-105 shadow-md hover:shadow-lg"
                                    title="Toggle auto-refresh">
                                <i class="fas fa-clock text-sm"></i>
                                <span>Auto</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Overall Progress -->
                    <div class="bg-gradient-to-br from-white to-indigo-50/30 border-2 border-indigo-200/50 rounded-3xl p-10 hover:shadow-xl transition-all duration-500 hover:border-indigo-300/70 animate-scale-in">
                        <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-8">
                            <div class="flex items-center space-x-4 mb-4 lg:mb-0">
                                <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-chart-line text-indigo-100 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-3xl font-bold text-slate-800 mb-1">Overall Progress</h3>
                                    <p class="text-slate-600">Your complete learning journey</p>
                                </div>
                            </div>
                            <div class="text-center lg:text-right">
                                <div class="relative">
                                    <span id="overallProgressText" class="text-5xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">0%</span>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center animate-pulse">
                                        <i class="fas fa-check text-white text-xs"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-slate-500 font-medium">Complete</p>
                            </div>
                        </div>
                        
                        <!-- Enhanced Progress Bar -->
                        <div class="mb-8">
                            <div class="relative">
                                <div class="w-full bg-slate-200/80 rounded-full h-8 mb-4 shadow-inner">
                                    <div class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 h-8 rounded-full transition-all duration-1500 ease-out shadow-lg flex items-center justify-end pr-3 relative overflow-hidden" id="overallProgress" style="width: 0%">
                                        <span class="text-white text-sm font-bold drop-shadow-sm" id="progressLabel">0%</span>
                                        <!-- Animated shimmer effect -->
                                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer"></div>
                                    </div>
                                </div>
                                <!-- Progress milestones -->
                                <div class="flex justify-between text-sm text-slate-600 font-medium">
                                    <span class="flex items-center space-x-1">
                                        <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                                        <span>0%</span>
                                    </span>
                                    <span class="flex items-center space-x-1">
                                        <div class="w-2 h-2 bg-indigo-400 rounded-full"></div>
                                        <span>25%</span>
                                    </span>
                                    <span class="flex items-center space-x-1">
                                        <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                        <span>50%</span>
                                    </span>
                                    <span class="flex items-center space-x-1">
                                        <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                        <span>75%</span>
                                    </span>
                                    <span class="flex items-center space-x-1">
                                        <div class="w-2 h-2 bg-pink-500 rounded-full"></div>
                                        <span>100%</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Enhanced footer with better visual hierarchy -->
                        <div class="flex flex-col lg:flex-row lg:items-center justify-between space-y-4 lg:space-y-0">
                            <div class="flex items-center space-x-3 text-slate-600">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-info-circle text-blue-600 text-sm"></i>
                                </div>
                                <span class="text-sm font-medium">Complete lessons to increase your progress</span>
                            </div>
                            <div class="flex items-center space-x-6 text-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="w-4 h-4 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full shadow-sm"></div>
                                    <span class="text-slate-600 font-medium">Completed</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-4 h-4 bg-slate-300 rounded-full"></div>
                                    <span class="text-slate-600 font-medium">Remaining</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Learning Path -->
                <div id="learning-path" class="bg-white/95 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/40 p-10 hover:shadow-3xl transition-all duration-500 animate-fade-in-up">
                    <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-12">
                        <div class="mb-6 lg:mb-0">
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-500 rounded-2xl flex items-center justify-center shadow-lg animate-float">
                                    <i class="fas fa-route text-2xl text-white"></i>
                                </div>
                                <div>
                                    <h2 class="text-4xl font-bold bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent mb-2">Learning Path</h2>
                                    <p class="text-lg text-slate-600">Master General Mathematics step by step with interactive lessons and assessments</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Progress Indicator -->
                    <div class="mb-12 bg-gradient-to-r from-slate-50 to-blue-50/50 rounded-2xl p-8 border border-slate-200/50">
                        <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-6">
                            <div class="flex items-center space-x-3 mb-4 lg:mb-0">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-md">
                                    <i class="fas fa-graduation-cap text-white text-sm"></i>
                                </div>
                                <span class="text-xl font-bold text-slate-700">Course Progress</span>
                            </div>
                            <span id="courseProgressText" class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">0 of 12 Lessons Completed</span>
                        </div>
                        <div class="relative">
                            <div class="w-full bg-slate-200/80 rounded-full h-6 mb-4 shadow-inner">
                                <div id="courseProgressBar" class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 h-6 rounded-full transition-all duration-1500 ease-out shadow-lg relative overflow-hidden" style="width: 0%">
                                    <!-- Animated shimmer effect -->
                                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer"></div>
                                </div>
                            </div>
                            <p class="text-sm text-slate-600 font-medium flex items-center space-x-2">
                                <i class="fas fa-info-circle text-blue-500"></i>
                                <span>Complete all topics in a lesson to mark it as completed</span>
                            </p>
                        </div>
                    </div>
                    
                    <!-- 1st Quarter Section -->
                    <div class="mb-12">
                        <div class="flex flex-col lg:flex-row lg:items-center mb-10">
                            <div class="w-20 h-20 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500 rounded-3xl flex items-center justify-center shadow-xl mr-8 mb-4 lg:mb-0 animate-scale-in">
                                <i class="fas fa-function text-3xl text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-5xl font-bold bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent mb-3">1st Quarter</h2>
                                <p class="text-xl text-slate-600 font-medium">Functions and Rational Functions</p>
                                <div class="flex items-center space-x-4 mt-3">
                                    <span class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium">4 Lessons</span>
                                    <span class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-medium">17 Topics</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid gap-8">
                            <!-- Functions Topic - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/functions.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-4">
                                            <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 1</span>
                                            <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Functions</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Learn the fundamental concepts of functions, including domain, range, and function notation. Understand how to represent functions algebraically, graphically, and in tabular form.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Evaluating Functions Topic - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/evaluating-functions.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-4">
                                            <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 2</span>
                                            <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Evaluating Functions</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Master the art of evaluating functions at specific values. Learn to substitute values into functions and solve real-world problems using function evaluation techniques.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Operations on Functions Topic - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/operations-on-functions.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-4">
                                            <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 3</span>
                                            <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">5 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Operations on Functions</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Explore addition, subtraction, multiplication, division, and composition of functions. Learn to perform operations on functions and understand their properties.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Solving Real-Life Problems Topic - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/solving-real-life-problems.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-4">
                                            <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 4</span>
                                            <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Solving Real-Life Problems</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Apply function concepts to solve practical problems in economics, physics, and everyday situations. Learn to model real-world scenarios using functions.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>

                        <!-- Rational Functions Topic - Available -->
                        <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/rational-functions.html')">
                            <div class="flex items-start justify-between">
                                <!-- Left side: Topic info -->
                                <div class="flex-1 pr-8">
                                    <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 5</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-4">Rational Functions</h3>
                                    <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                        Study functions that are ratios of polynomials. Learn about their properties, asymptotes, and how to graph rational functions effectively.
                                    </p>
                                </div>
                                
                                <!-- Right side: Button -->
                                <div class="flex flex-col items-end space-y-4 ml-8">
                                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                        Start Learning
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Solving Rational Equations and Inequalities Topic - Available -->
                        <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/solving-rational-equations-inequalities.html')">
                            <div class="flex items-start justify-between">
                                <!-- Left side: Topic info -->
                                <div class="flex-1 pr-8">
                                    <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 6</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-4">Solving Rational Equations and Inequalities</h3>
                                    <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                        Master techniques for solving rational equations and inequalities. Learn to find restrictions, check solutions, and solve complex rational problems.
                                    </p>
                                </div>
                                
                                <!-- Right side: Button -->
                                <div class="flex flex-col items-end space-y-4 ml-8">
                                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                        Start Learning
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Representations of Rational Functions Topic - Available -->
                        <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/representations-of-rational-functions.html')">
                            <div class="flex items-start justify-between">
                                <!-- Left side: Topic info -->
                                <div class="flex-1 pr-8">
                                    <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 7</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-4">Representations of Rational Functions</h3>
                                    <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                        Explore different ways to represent rational functions: algebraic, graphical, and tabular forms. Understand their characteristics and behavior.
                                    </p>
                                </div>
                                
                                <!-- Right side: Button -->
                                <div class="flex flex-col items-end space-y-4 ml-8">
                                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                        Start Learning
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- The Domain and Range of a Rational Functions Topic - Available -->
                        <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/domain-range-rational-functions.html')">
                            <div class="flex items-start justify-between">
                                <!-- Left side: Topic info -->
                                <div class="flex-1 pr-8">
                                    <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 8</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-4">The Domain and Range of a Rational Functions</h3>
                                    <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                        Determine the domain and range of rational functions. Learn to identify restrictions and understand the behavior of rational functions.
                                    </p>
                                </div>
                                
                                <!-- Right side: Button -->
                                <div class="flex flex-col items-end space-y-4 ml-8">
                                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                        Start Learning
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- One-to-One Functions Topic - Available -->
                        <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/one-to-one-functions.html')">
                            <div class="flex items-start justify-between">
                                <!-- Left side: Topic info -->
                                <div class="flex-1 pr-8">
                                    <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 9</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-4">One-to-One Functions</h3>
                                    <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                        Understand one-to-one functions and their properties. Learn the horizontal line test and explore inverse functions and their applications.
                                    </p>
                                </div>
                                
                                <!-- Right side: Button -->
                                <div class="flex flex-col items-end space-y-4 ml-8">
                                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                        Start Learning
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Domain and Range of Inverse Functions Topic - Available -->
                        <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/domain-range-inverse-functions.html')">
                            <div class="flex items-start justify-between">
                                <!-- Left side: Topic info -->
                                <div class="flex-1 pr-8">
                                    <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 10</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">4 Topics</span>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-4">Domain and Range of Inverse Functions</h3>
                                    <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                        Explore the relationship between functions and their inverses. Learn to determine domain and range of inverse functions and their applications.
                                    </p>
                                </div>
                                
                                <!-- Right side: Button -->
                                <div class="flex flex-col items-end space-y-4 ml-8">
                                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                        Start Learning
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                    
                    <!-- 2nd Quarter Section -->
                    <div class="mt-16">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-200 via-emerald-200 to-teal-200 rounded-2xl flex items-center justify-center shadow-lg mr-6">
                                <i class="fas fa-calculator text-2xl text-green-600"></i>
                            </div>
                            <div>
                                <h2 class="text-4xl font-bold bg-gradient-to-r from-green-500 to-emerald-500 bg-clip-text text-transparent mb-2">2nd Quarter</h2>
                                <p class="text-lg text-slate-600">Financial Mathematics and Interest Calculations</p>
                            </div>
                        </div>
                        
                        <!-- 2nd Quarter Progress -->
                        <div class="mb-8">
                            <div class="bg-white border-2 border-green-200 rounded-3xl p-8 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-center justify-between mb-6">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center">
                                            <i class="fas fa-chart-line text-green-600 text-xl"></i>
                                        </div>
                                        <h3 class="text-2xl font-bold text-slate-800">2nd Quarter Progress</h3>
                                    </div>
                                    <div class="text-right">
                                        <span id="secondQuarterProgressText" class="text-4xl font-bold text-green-600">0%</span>
                                        <p class="text-sm text-slate-500">Complete</p>
                                    </div>
                                </div>
                                <div class="mb-6">
                                    <div class="w-full bg-slate-200 rounded-full h-6 mb-4">
                                        <div class="bg-green-500 h-6 rounded-full transition-all duration-1000 shadow-sm flex items-center justify-end pr-2" id="secondQuarterProgress" style="width: 0%">
                                            <span class="text-white text-xs font-medium" id="secondQuarterProgressLabel">0%</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between text-sm text-slate-600">
                                        <span>0%</span>
                                        <span>25%</span>
                                        <span>50%</span>
                                        <span>75%</span>
                                        <span>100%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="text-sm text-slate-600">
                                        <i class="fas fa-info-circle mr-2 text-green-500"></i>
                                        Complete 2nd Quarter topics to increase your progress
                                    </div>
                                    <div class="flex items-center space-x-4 text-sm">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-slate-600">Completed</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-slate-300 rounded-full"></div>
                                            <span class="text-slate-600">Remaining</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-8">
                            <!-- Simple Interest Topic - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/simple-interest.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 11</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">5 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Simple Interest</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Learn the fundamentals of simple interest calculations. Understand the formula, solve problems, and apply concepts to real-world financial situations.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Compound Interest Topic - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/compound-interest.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 12</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">5 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Compound Interest</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Master compound interest calculations and understand the power of compounding. Learn to solve complex financial problems involving compound interest.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Interest, Maturity, Future, and Present Values (Simple & Compound) - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/simple-and-compound-values.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-3">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 13</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">5 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-3">Interest, Maturity, Future, and Present Values</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Calculate maturity values, future values, and present values for both simple and compound interest. Master essential financial mathematics concepts.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Solving Problems Involving Simple and Compound Interest - Available -->
                            <div class="group bg-purple-100 rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-800" onclick="checkEnrollmentAndNavigate('topics/solving-interest-problems.html')">
                                <div class="flex items-start justify-between">
                                    <!-- Left side: Topic info -->
                                    <div class="flex-1 pr-8">
                                        <div class="flex items-center space-x-4 mb-3">
                                        <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">Lesson 14</span>
                                        <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium">5 Topics</span>
                                        </div>
                                        <h3 class="text-2xl font-bold text-gray-900 mb-3">Solving Problems: Simple and Compound Interest</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed max-w-2xl">
                                            Apply your knowledge of simple and compound interest to solve complex real-world problems. Practice with various scenarios and master problem-solving techniques.
                                        </p>
                                    </div>
                                    
                                    <!-- Right side: Button -->
                                    <div class="flex flex-col items-end space-y-4 ml-8">
                                        <button class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors">
                                            Start Learning
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
                    
                </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white mt-20 relative overflow-hidden">
        <!-- Background Pattern -->
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.03"%3E%3Ccircle cx="30" cy="30" r="1.5"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-60"></div>
        
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-indigo-900/20 via-transparent to-transparent"></div>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 relative">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-12">
                <!-- Brand Section -->
                <div class="md:col-span-1">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg">
                            <img src="css/nav-logo/nav-logo.png" alt="MathEase Logo" class="h-7 w-7">
                        </div>
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-white to-indigo-200 bg-clip-text text-transparent">MathEase</h3>
                    </div>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6">Empowering Grade 11 STEM students to master General Mathematics through interactive learning and personalized progress tracking.</p>
                    <div class="flex items-center space-x-2 text-slate-400 text-xs">
                        <i class="fas fa-graduation-cap text-indigo-400"></i>
                        <span>Norzagaray College</span>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h3 class="text-lg font-semibold mb-6 text-white flex items-center">
                        <i class="fas fa-link text-indigo-400 mr-2 text-sm"></i>
                        Quick Links
                    </h3>
                    <ul class="space-y-3">
                        <li><a href="index.html" class="text-slate-400 hover:text-indigo-400 text-sm transition-all hover:translate-x-1 inline-flex items-center group">
                            <i class="fas fa-chevron-right text-xs mr-2 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                            Home
                        </a></li>
                        <li><a href="#learning-path" id="topicsNavLinkMobile" class="text-slate-400 hover:text-indigo-400 text-sm transition-all hover:translate-x-1 inline-flex items-center group">
                            <i class="fas fa-chevron-right text-xs mr-2 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                            Topics
                        </a></li>
                        <li><a href="quizzes.html" id="quizzesNavLinkMobile" class="text-slate-400 hover:text-indigo-400 text-sm transition-all hover:translate-x-1 inline-flex items-center group">
                            <i class="fas fa-chevron-right text-xs mr-2 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                            Quizzes
                        </a></li>
                        <li><a href="achievements.html" class="text-slate-400 hover:text-indigo-400 text-sm transition-all hover:translate-x-1 inline-flex items-center group">
                            <i class="fas fa-chevron-right text-xs mr-2 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                            Achievements
                        </a></li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
                    <h3 class="text-lg font-semibold mb-6 text-white flex items-center">
                        <i class="fas fa-envelope text-indigo-400 mr-2 text-sm"></i>
                        Contact Us
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-map-marker-alt text-indigo-400 mt-1 text-sm"></i>
                            <p class="text-slate-400 text-sm">Norzagaray College<br>Norzagaray, Bulacan</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-envelope text-indigo-400 text-sm"></i>
                            <a href="mailto:matheasenc@gmail.com" class="text-slate-400 hover:text-indigo-400 text-sm transition-colors">matheasenc@gmail.com</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="border-t border-slate-700/50 pt-8 mt-8">
                <div class="text-center">
                    <p class="text-slate-400 text-sm mb-2">&copy; 2025 <span class="text-white font-semibold">MathEase</span>. All rights reserved.</p>
                    <p class="text-slate-500 text-xs">Developed with <i class="fas fa-heart text-red-500 animate-pulse"></i> by Computer Science Students from <span class="text-indigo-400 font-medium">Norzagaray College</span></p>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/join-class-modal.js"></script>
    <script src="js/student-enrollment-check.js"></script>
    <script src="js/session-manager.js"></script>
    
    <script>
        // Function to check and update topic lock status
        async function updateTopicLockStatus() {
            console.log('updateTopicLockStatus called');
            if (!window.studentEnrollmentCheck || !window.studentEnrollmentCheck.enrollmentStatus?.has_approved_enrollment) {
                console.log('Student not enrolled or enrollment check not available');
                return;
            }

            const topics = [
                { id: 'functions', element: document.querySelector('[onclick*="functions.html"]') },
                { id: 'evaluating-functions', element: document.querySelector('[onclick*="evaluating-functions.html"]') },
                { id: 'operations-on-functions', element: document.querySelector('[onclick*="operations-on-functions.html"]') },
                { id: 'solving-real-life-problems', element: document.querySelector('[onclick*="solving-real-life-problems.html"]') },
                { id: 'rational-functions', element: document.querySelector('[onclick*="rational-functions.html"]') },
                { id: 'solving-rational-equations-inequalities', element: document.querySelector('[onclick*="solving-rational-equations-inequalities.html"]') },
                { id: 'representations-of-rational-functions', element: document.querySelector('[onclick*="representations-of-rational-functions.html"]') },
                { id: 'domain-range-rational-functions', element: document.querySelector('[onclick*="domain-range-rational-functions.html"]') },
                { id: 'one-to-one-functions', element: document.querySelector('[onclick*="one-to-one-functions.html"]') },
                { id: 'domain-range-inverse-functions', element: document.querySelector('[onclick*="domain-range-inverse-functions.html"]') },
                { id: 'simple-interest', element: document.querySelector('[onclick*="simple-interest.html"]') },
                { id: 'compound-interest', element: document.querySelector('[onclick*="compound-interest.html"]') },
                { id: 'simple-and-compound-values', element: document.querySelector('[onclick*="simple-and-compound-values.html"]') },
                { id: 'solving-interest-problems', element: document.querySelector('[onclick*="solving-interest-problems.html"]') }
            ];
            
            console.log('Found topics:', topics.map(t => ({ id: t.id, found: !!t.element })));

            for (const topic of topics) {
                if (topic.element) {
                    try {
                        console.log(`Checking lock status for ${topic.id}`);
                        const lockStatus = await window.studentEnrollmentCheck.checkTopicLock(topic.id);
                        console.log(`Lock status for ${topic.id}:`, lockStatus);
                        
                        if (lockStatus.is_locked) {
                            console.log(`Applying locked styling to ${topic.id}`);
                            // Apply locked styling similar to "Coming Soon" topics
                            topic.element.classList.add('topic-locked');
                            
                            // Change the entire card styling to match development topics
                            topic.element.className = 'group bg-gradient-to-r from-slate-100 to-slate-200 rounded-3xl p-8 text-slate-600 hover:scale-102 transition-all duration-500 shadow-lg cursor-pointer border-2 border-slate-200';
                            
                            // Update the icon container
                            const iconContainer = topic.element.querySelector('.w-16');
                            if (iconContainer) {
                                iconContainer.className = 'w-16 h-16 bg-slate-300 rounded-2xl flex items-center justify-center';
                                const icon = iconContainer.querySelector('i');
                                if (icon) {
                                    icon.className = icon.className.replace('text-2xl', 'text-2xl text-slate-500');
                                }
                            }
                            
                            // Update status badge
                            const statusBadge = topic.element.querySelector('[class*="bg-white/20"]');
                            if (statusBadge) {
                                statusBadge.className = 'text-sm font-medium bg-slate-300 px-3 py-1 rounded-full';
                                statusBadge.textContent = 'Locked by Teacher';
                            }
                            
                            // Update title color
                            const title = topic.element.querySelector('h3');
                            if (title) {
                                title.className = 'text-2xl font-bold mb-2 text-slate-700';
                            }
                            
                            // Update description color
                            const description = topic.element.querySelector('p');
                            if (description) {
                                description.className = 'text-slate-500 text-sm';
                            }
                            
                            // Update status indicator
                            const statusSpan = topic.element.querySelector('[class*="text-white/80"]');
                            if (statusSpan) {
                                statusSpan.textContent = 'Locked by Teacher';
                                statusSpan.className = 'text-sm text-slate-500';
                            }
                            
                            // Update status dot
                            const statusDot = topic.element.querySelector('.bg-green-400');
                            if (statusDot) {
                                statusDot.className = 'w-3 h-3 bg-yellow-400 rounded-full';
                            }
                            
                            // Update button to match development style
                            const button = topic.element.querySelector('[class*="bg-white/20"]');
                            if (button) {
                                button.className = 'bg-slate-300 text-slate-500 px-6 py-3 rounded-xl text-sm font-bold cursor-not-allowed';
                                button.innerHTML = '<i class="fas fa-lock mr-2"></i>Locked';
                            }
                        } else {
                            // Ensure unlocked styling
                            topic.element.classList.remove('topic-locked');
                            topic.element.style.opacity = '1';
                            topic.element.style.filter = 'none';
                        }
                    } catch (error) {
                        console.error(`Error checking lock status for ${topic.id}:`, error);
                    }
                }
            }

        }


        // Update topic lock status when page loads and enrollment status changes
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for enrollment check to complete
            setTimeout(updateTopicLockStatus, 1000);
        });

        // Manual function to test topic lock status (for debugging)
        window.testTopicLock = function() {
            console.log('Manual test of topic lock status');
            updateTopicLockStatus();
        };

        // Manual function to test navigation state (for debugging)
        window.testNavigationState = function() {
            console.log('Manual test of navigation state');
            console.log('Current enrollment status:', window.studentEnrollmentCheck?.enrollmentStatus);
            updateNavigationState();
        };
        
        // Global function to refresh navigation state (can be called from console or other scripts)
        window.refreshNavigationState = function() {
            console.log('Refreshing navigation state...');
            updateNavigationState();
            updateNotificationButtonState();
        };

        // Also update when enrollment status changes
        if (window.studentEnrollmentCheck) {
            const originalUpdateDashboard = window.studentEnrollmentCheck.updateDashboard;
            window.studentEnrollmentCheck.updateDashboard = function() {
                originalUpdateDashboard.call(this);
                updateTopicLockStatus();
                updateNotificationButtonState(); // Update notification button state
                updateNavigationState(); // Update navigation state
                // Student avatar loading disabled - avatars removed from UI
                // loadTopicStudentData();
            };
        }

    </script>
    
    <script>
        // Notification System
        class NotificationSystem {
            constructor() {
                this.notifications = [];
                this.unreadCount = 0;
                this.isDropdownOpen = false;
                this.init();
            }

            async init() {
                try {
                    // Always load notifications regardless of enrollment status
                    await this.loadNotifications();
                    await this.loadUnreadCount();
                    this.updateNotificationBadge();
                    this.setupEventListeners();
                    
                    // Auto-refresh notifications every 30 seconds
                    setInterval(() => {
                        this.loadUnreadCount();
                    }, 30000);
                } catch (error) {
                    console.error('Failed to initialize notification system:', error);
                }
            }

            async loadNotifications(limit = 10) {
                try {
                    const response = await fetch(`php/notifications.php?action=get_notifications&limit=${limit}`, {
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.success) {
                            this.notifications = data.notifications || [];
                            this.updateNotificationsList();
                        } else {
                            console.error('Failed to load notifications:', data.message);
                            // Show empty state
                            this.notifications = [];
                            this.updateNotificationsList();
                        }
                    } else {
                        console.error('Failed to fetch notifications, status:', response.status);
                        // Show empty state
                        this.notifications = [];
                        this.updateNotificationsList();
                    }
                } catch (error) {
                    console.error('Error loading notifications:', error);
                    // Show empty state
                    this.notifications = [];
                    this.updateNotificationsList();
                }
            }

            async loadUnreadCount() {
                try {
                    const response = await fetch('php/notifications.php?action=get_unread_count', {
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.success) {
                            this.unreadCount = data.unread_count || 0;
                            this.updateNotificationBadge();
                        } else {
                            console.error('Failed to load unread count:', data.message);
                            this.unreadCount = 0;
                            this.updateNotificationBadge();
                        }
                    } else {
                        console.error('Failed to fetch unread count, status:', response.status);
                        this.unreadCount = 0;
                        this.updateNotificationBadge();
                    }
                } catch (error) {
                    console.error('Error loading unread count:', error);
                    this.unreadCount = 0;
                    this.updateNotificationBadge();
                }
            }

            updateNotificationBadge() {
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    if (this.unreadCount > 0) {
                        badge.textContent = this.unreadCount > 99 ? '99+' : this.unreadCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            }

            updateNotificationsList() {
                const list = document.getElementById('notificationsList');
                if (!list) {
                    console.error('Notifications list element not found');
                    return;
                }

                // Update dropdown counter
                const dropdownCounter = document.getElementById('dropdownNotificationCount');
                if (dropdownCounter) {
                    dropdownCounter.textContent = this.notifications.length;
                }

                if (this.notifications.length === 0) {
                    list.innerHTML = `
                        <div class="px-4 py-8 text-center text-slate-500">
                            <i class="fas fa-bell-slash text-2xl mb-2"></i>
                            <p class="text-sm">No notifications yet</p>
                        </div>
                    `;
                    return;
                }

                list.innerHTML = this.notifications.map(notification => `
                    <div class="px-4 py-3 hover:bg-slate-50 transition-colors cursor-pointer ${!notification.is_read ? 'bg-blue-50 border-l-4 border-blue-500' : ''}" 
                         onclick="markNotificationAsRead(${notification.id})">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 mt-1">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center ${this.getNotificationIconClass(notification.type)}">
                                    <i class="fas ${this.getNotificationIcon(notification.type)} text-xs"></i>
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-slate-900 truncate">${notification.title}</p>
                                <p class="text-xs text-slate-600 mt-1 line-clamp-2">${notification.message}</p>
                                <p class="text-xs text-slate-400 mt-1">${this.formatTime(notification.created_timestamp || notification.created_at)}</p>
                            </div>
                            ${!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2"></div>' : ''}
                        </div>
                    </div>
                `).join('');
            }

            getNotificationIcon(type) {
                const icons = {
                    'class_deleted': 'fa-exclamation-triangle',
                    'class_created': 'fa-plus-circle',
                    'enrollment_approved': 'fa-check-circle',
                    'enrollment_rejected': 'fa-times-circle',
                    'topic_locked': 'fa-lock',
                    'topic_unlocked': 'fa-unlock',
                    'quiz_assigned': 'fa-question-circle',
                    'assignment_due': 'fa-clock'
                };
                return icons[type] || 'fa-bell';
            }

            getNotificationIconClass(type) {
                const classes = {
                    'class_deleted': 'bg-red-100 text-red-600',
                    'class_created': 'bg-green-100 text-green-600',
                    'enrollment_approved': 'bg-green-100 text-green-600',
                    'enrollment_rejected': 'bg-red-100 text-red-600',
                    'topic_locked': 'bg-orange-100 text-orange-600',
                    'topic_unlocked': 'bg-emerald-100 text-emerald-600',
                    'quiz_assigned': 'bg-blue-100 text-blue-600',
                    'assignment_due': 'bg-yellow-100 text-yellow-600'
                };
                return classes[type] || 'bg-gray-100 text-gray-600';
            }

            formatTime(timestamp) {
                // Handle both string timestamps and Unix timestamps
                let time;
                if (typeof timestamp === 'string') {
                    time = new Date(timestamp);
                } else if (typeof timestamp === 'number') {
                    time = new Date(timestamp * 1000); // Convert Unix timestamp to milliseconds
                } else {
                    time = new Date(timestamp);
                }
                
                // Check if the date is valid
                if (isNaN(time.getTime())) {
                    return 'Unknown time';
                }
                
                const now = new Date();
                const diff = now - time;
                
                // Less than 1 minute
                if (diff < 60000) return 'Just now';
                
                // Less than 1 hour
                if (diff < 3600000) {
                    const minutes = Math.floor(diff / 60000);
                    return `${minutes}m ago`;
                }
                
                // Less than 24 hours
                if (diff < 86400000) {
                    const hours = Math.floor(diff / 3600000);
                    return `${hours}h ago`;
                }
                
                // Less than 7 days
                if (diff < 604800000) {
                    const days = Math.floor(diff / 86400000);
                    return `${days}d ago`;
                }
                
                // More than 7 days - show full date
                return time.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            setupEventListeners() {
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    const dropdown = document.getElementById('notificationsDropdown');
                    const button = e.target.closest('[onclick="toggleNotifications()"]');
                    
                    if (!button && !dropdown?.contains(e.target)) {
                        this.closeDropdown();
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // ESC to close modal
                    if (e.key === 'Escape') {
                        const modal = document.getElementById('notificationsModal');
                        if (modal) {
                            this.closeNotificationsModal();
                        }
                    }
                    
                    // Ctrl+N to open notifications modal
                    if (e.ctrlKey && e.key === 'n') {
                        e.preventDefault();
                        this.showAllNotificationsModal();
                    }
                });
            }

            toggleDropdown() {
                const dropdown = document.getElementById('notificationsDropdown');
                if (!dropdown) {
                    console.error('Notifications dropdown element not found');
                    return;
                }

                this.isDropdownOpen = !this.isDropdownOpen;
                
                if (this.isDropdownOpen) {
                    dropdown.classList.remove('opacity-0', 'invisible');
                    dropdown.classList.add('opacity-100', 'visible');
                    this.loadNotifications();
                } else {
                    this.closeDropdown();
                }
            }

            closeDropdown() {
                const dropdown = document.getElementById('notificationsDropdown');
                if (dropdown) {
                    dropdown.classList.add('opacity-0', 'invisible');
                    dropdown.classList.remove('opacity-100', 'visible');
                    this.isDropdownOpen = false;
                }
            }

            async showAllNotificationsModal() {
                try {
                    // Load all notifications (not just recent ones)
                    await this.loadNotifications(100);
                    
                    // Create and show the modal
                    this.createNotificationsModal();
                } catch (error) {
                    console.error('Error showing notifications modal:', error);
                }
            }

            createNotificationsModal() {
                // Remove existing modal if any
                const existingModal = document.getElementById('notificationsModal');
                if (existingModal) {
                    existingModal.remove();
                }

                // Create modal HTML
                const modalHTML = `
                    <div id="notificationsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                            <!-- Modal Header -->
                            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-bell text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-2xl font-bold text-gray-900">Notifications</h2>
                                        <p class="text-sm text-gray-600">Manage your notifications</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button onclick="window.notificationSystem.markAllAsRead()" 
                                            class="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">
                                        <i class="fas fa-check-double mr-2"></i>
                                        Mark All Read
                                    </button>
                                    <button onclick="window.notificationSystem.closeNotificationsModal()" 
                                            class="bg-gray-100 hover:bg-gray-200 text-gray-700 p-2 rounded-lg transition-all duration-200">
                                        <i class="fas fa-times text-lg"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Filter Tabs -->
                            <div class="px-6 py-4 border-b border-gray-200">
                                <div class="flex space-x-1 bg-gray-100 rounded-lg p-1">
                                    <button onclick="window.notificationSystem.filterNotifications('all')" 
                                            class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 active" 
                                            data-filter="all">
                                        All Notifications
                                    </button>
                                    <button onclick="window.notificationSystem.filterNotifications('unread')" 
                                            class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-all duration-200" 
                                            data-filter="unread">
                                        Unread
                                    </button>
                                    <button onclick="window.notificationSystem.filterNotifications('class_deleted')" 
                                            class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-all duration-200" 
                                            data-filter="class_deleted">
                                        Class Updates
                                    </button>
                                    <button onclick="window.notificationSystem.filterNotifications('enrollment')" 
                                            class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-all duration-200" 
                                            data-filter="enrollment">
                                        Enrollment
                                    </button>
                                    <button onclick="window.notificationSystem.filterNotifications('topic')" 
                                            class="filter-tab px-4 py-2 rounded-md text-sm font-medium transition-all duration-200" 
                                            data-filter="topic">
                                        Topic Updates
                                    </button>
                                </div>
                            </div>

                            <!-- Notifications List -->
                            <div class="flex-1 overflow-y-auto p-6">
                                <div id="allNotificationsList" class="space-y-4">
                                    <!-- Notifications will be populated here -->
                                </div>
                            </div>

                            <!-- Modal Footer -->
                            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm text-gray-600">
                                        <span id="notificationCount">0</span> notifications total
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="window.notificationSystem.deleteAllRead()" 
                                                class="bg-red-100 hover:bg-red-200 text-red-700 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">
                                            <i class="fas fa-trash mr-2"></i>
                                            Delete Read
                                        </button>
                                        <button onclick="window.notificationSystem.refreshNotifications()" 
                                                class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200">
                                            <i class="fas fa-sync-alt mr-2"></i>
                                            Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Add modal to page
                document.body.insertAdjacentHTML('beforeend', modalHTML);

                // Update the notifications list
                this.updateAllNotificationsList();

                // Add click outside to close
                document.getElementById('notificationsModal').addEventListener('click', (e) => {
                    if (e.target.id === 'notificationsModal') {
                        this.closeNotificationsModal();
                    }
                });
            }

            updateAllNotificationsList() {
                const list = document.getElementById('allNotificationsList');
                if (!list) return;

                const currentFilter = this.currentFilter || 'all';
                let filteredNotifications = this.notifications;

                // Apply filter
                if (currentFilter === 'unread') {
                    filteredNotifications = this.notifications.filter(n => !n.is_read);
                } else if (currentFilter === 'class_deleted') {
                    filteredNotifications = this.notifications.filter(n => n.type === 'class_deleted');
                } else if (currentFilter === 'enrollment') {
                    filteredNotifications = this.notifications.filter(n => 
                        n.type.includes('enrollment') || n.type.includes('class_created')
                    );
                } else if (currentFilter === 'topic') {
                    filteredNotifications = this.notifications.filter(n => 
                        n.type === 'topic_locked' || n.type === 'topic_unlocked'
                    );
                }

                // Update count
                const countElement = document.getElementById('notificationCount');
                if (countElement) {
                    countElement.textContent = filteredNotifications.length;
                }

                if (filteredNotifications.length === 0) {
                    list.innerHTML = `
                        <div class="text-center py-12">
                            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-bell-slash text-gray-400 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No notifications</h3>
                            <p class="text-gray-600">You're all caught up!</p>
                        </div>
                    `;
                    return;
                }

                list.innerHTML = filteredNotifications.map(notification => `
                    <div class="notification-card bg-white border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all duration-200 ${!notification.is_read ? 'border-l-4 border-l-blue-500 bg-blue-50' : ''}">
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center ${this.getNotificationIconClass(notification.type)}">
                                    <i class="fas ${this.getNotificationIcon(notification.type)} text-lg"></i>
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h4 class="text-lg font-semibold text-gray-900 mb-1">${notification.title}</h4>
                                        <p class="text-gray-700 mb-3 leading-relaxed">${notification.message}</p>
                                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                                            <span class="flex items-center">
                                                <i class="fas fa-clock mr-1"></i>
                                                ${this.formatTime(notification.created_timestamp || notification.created_at)}
                                            </span>
                                            <span class="flex items-center">
                                                <i class="fas fa-tag mr-1"></i>
                                                ${this.getNotificationTypeLabel(notification.type)}
                                            </span>
                                            ${!notification.is_read ? '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">Unread</span>' : ''}
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2 ml-4">
                                        ${!notification.is_read ? 
                                            `<button onclick="window.notificationSystem.markAsRead(${notification.id})" 
                                                     class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg text-sm font-medium transition-all duration-200">
                                                <i class="fas fa-check mr-1"></i>
                                                Mark Read
                                            </button>` : ''
                                        }
                                        <button onclick="window.notificationSystem.deleteNotification(${notification.id})" 
                                                class="bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg text-sm font-medium transition-all duration-200">
                                            <i class="fas fa-trash mr-1"></i>
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            filterNotifications(filter) {
                this.currentFilter = filter;
                
                // Update active tab
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.classList.remove('active', 'bg-indigo-500', 'text-white');
                    tab.classList.add('text-gray-600');
                });
                
                const activeTab = document.querySelector(`[data-filter="${filter}"]`);
                if (activeTab) {
                    activeTab.classList.add('active', 'bg-indigo-500', 'text-white');
                    activeTab.classList.remove('text-gray-600');
                }
                
                this.updateAllNotificationsList();
            }

            async markAllAsRead() {
                try {
                    const formData = new FormData();
                    formData.append('action', 'mark_all_as_read');

                    const response = await fetch('php/notifications.php', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // Reload notifications
                            await this.loadNotifications(100);
                            await this.loadUnreadCount();
                            this.updateAllNotificationsList();
                        }
                    }
                } catch (error) {
                    console.error('Error marking all notifications as read:', error);
                }
            }

            async markAsRead(notificationId) {
                try {
                    const formData = new FormData();
                    formData.append('action', 'mark_as_read');
                    formData.append('notification_id', notificationId);

                    const response = await fetch('php/notifications.php', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // Reload notifications
                            await this.loadNotifications(100);
                            await this.loadUnreadCount();
                            this.updateAllNotificationsList();
                        }
                    }
                } catch (error) {
                    console.error('Error marking notification as read:', error);
                }
            }

            async deleteNotification(notificationId) {
                if (!confirm('Are you sure you want to delete this notification?')) {
                    return;
                }

                try {
                    const formData = new FormData();
                    formData.append('action', 'delete_notification');
                    formData.append('notification_id', notificationId);

                    const response = await fetch('php/notifications.php', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // Reload notifications
                            await this.loadNotifications(100);
                            await this.loadUnreadCount();
                            this.updateAllNotificationsList();
                        }
                    }
                } catch (error) {
                    console.error('Error deleting notification:', error);
                }
            }

            async deleteAllRead() {
                if (!confirm('Are you sure you want to delete all read notifications?')) {
                    return;
                }

                try {
                    const readNotifications = this.notifications.filter(n => n.is_read);
                    
                    for (const notification of readNotifications) {
                        await this.deleteNotification(notification.id);
                    }
                } catch (error) {
                    console.error('Error deleting all read notifications:', error);
                }
            }

            async refreshNotifications() {
                await this.loadNotifications(100);
                await this.loadUnreadCount();
                this.updateAllNotificationsList();
            }

            closeNotificationsModal() {
                const modal = document.getElementById('notificationsModal');
                if (modal) {
                    modal.remove();
                }
            }

            getNotificationTypeLabel(type) {
                const labels = {
                    'class_deleted': 'Class Deleted',
                    'class_created': 'Class Created',
                    'enrollment_approved': 'Enrollment Approved',
                    'enrollment_rejected': 'Enrollment Rejected',
                    'topic_locked': 'Topic Locked',
                    'topic_unlocked': 'Topic Unlocked',
                    'quiz_assigned': 'Quiz Assigned',
                    'assignment_due': 'Assignment Due'
                };
                return labels[type] || 'Notification';
            }
        }

        // Global notification functions
        function toggleNotifications() {
            // Check enrollment status before allowing access to notifications
            if (window.studentEnrollmentCheck) {
                if (window.studentEnrollmentCheck.enrollmentStatus && window.studentEnrollmentCheck.enrollmentStatus.has_approved_enrollment) {
                    // Student is enrolled, allow access to notifications
            if (window.notificationSystem) {
                window.notificationSystem.toggleDropdown();
                    }
                } else {
                    // Student is not enrolled, show enrollment required modal
                    window.studentEnrollmentCheck.showEnrollmentRequiredModal();
                }
            } else {
                // Fallback - show alert
                Swal.fire({
                    title: 'Enrollment Required',
                    text: 'You need to join a class to access notifications. Please ask your teacher for the class code.',
                    icon: 'info',
                    confirmButtonText: 'Join Class',
                    confirmButtonColor: '#6366f1',
                    background: '#ffffff',
                    customClass: {
                        popup: 'rounded-2xl',
                        title: 'text-slate-800',
                        content: 'text-slate-600'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Open join class modal if available
                        if (window.studentEnrollmentCheck && window.studentEnrollmentCheck.openJoinClassModal) {
                            window.studentEnrollmentCheck.openJoinClassModal();
                        }
                    }
                });
            }
        }

        async function markNotificationAsRead(notificationId) {
            try {
                const formData = new FormData();
                formData.append('action', 'mark_as_read');
                formData.append('notification_id', notificationId);

                const response = await fetch('php/notifications.php', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        // Reload notifications and unread count
                        if (window.notificationSystem) {
                            await window.notificationSystem.loadNotifications();
                            await window.notificationSystem.loadUnreadCount();
                        }
                    }
                }
            } catch (error) {
                console.error('Error marking notification as read:', error);
            }
        }

        async function markAllNotificationsAsRead() {
            try {
                const formData = new FormData();
                formData.append('action', 'mark_all_as_read');

                const response = await fetch('php/notifications.php', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        // Reload notifications and unread count
                        if (window.notificationSystem) {
                            await window.notificationSystem.loadNotifications();
                            await window.notificationSystem.loadUnreadCount();
                        }
                    }
                }
            } catch (error) {
                console.error('Error marking all notifications as read:', error);
            }
        }

        function showAllNotifications() {
            // Check enrollment status before allowing access to notifications
            if (window.studentEnrollmentCheck) {
                if (window.studentEnrollmentCheck.enrollmentStatus && window.studentEnrollmentCheck.enrollmentStatus.has_approved_enrollment) {
                    // Student is enrolled, allow access to notifications
            if (window.notificationSystem) {
                window.notificationSystem.showAllNotificationsModal();
                    }
                } else {
                    // Student is not enrolled, show enrollment required modal
                    window.studentEnrollmentCheck.showEnrollmentRequiredModal();
                }
            } else {
                // Fallback - show alert
                Swal.fire({
                    title: 'Enrollment Required',
                    text: 'You need to join a class to access notifications. Please ask your teacher for the class code.',
                    icon: 'info',
                    confirmButtonText: 'Join Class',
                    confirmButtonColor: '#6366f1',
                    background: '#ffffff',
                    customClass: {
                        popup: 'rounded-2xl',
                        title: 'text-slate-800',
                        content: 'text-slate-600'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Open join class modal if available
                        if (window.studentEnrollmentCheck && window.studentEnrollmentCheck.openJoinClassModal) {
                            window.studentEnrollmentCheck.openJoinClassModal();
                        }
                    }
                });
            }
        }


        // Function to update navigation state based on enrollment
        function updateNavigationState() {
            const navLinks = [
                { id: 'topicsNavLink', name: 'Topics' },
                { id: 'quizzesNavLink', name: 'Quizzes' },
                { id: 'achievementsNavLink', name: 'Achievements' },
                { id: 'progressNavLink', name: 'Progress' },
                // Mobile navigation links
                { id: 'topicsNavLinkMobile', name: 'Topics' },
                { id: 'quizzesNavLinkMobile', name: 'Quizzes' },
                { id: 'progressNavLinkMobile', name: 'Progress' }
            ];
            
            const isEnrolled = window.studentEnrollmentCheck && 
                window.studentEnrollmentCheck.enrollmentStatus && 
                window.studentEnrollmentCheck.enrollmentStatus.has_approved_enrollment;
            
            // Debug logging
            console.log('updateNavigationState called');
            console.log('studentEnrollmentCheck exists:', !!window.studentEnrollmentCheck);
            console.log('enrollmentStatus exists:', !!(window.studentEnrollmentCheck && window.studentEnrollmentCheck.enrollmentStatus));
            console.log('has_approved_enrollment:', window.studentEnrollmentCheck?.enrollmentStatus?.has_approved_enrollment);
            console.log('isEnrolled:', isEnrolled);
            
            navLinks.forEach(link => {
                const element = document.getElementById(link.id);
                if (!element) {
                    console.log(`Element not found: ${link.id}`);
                    return;
                }
                
                if (isEnrolled) {
                    // Student is enrolled - enable navigation
                    console.log(`Enabling navigation for ${link.id}`);
                    element.classList.remove('opacity-50', 'cursor-not-allowed', 'pointer-events-none');
                    element.classList.add('hover:text-slate-800', 'hover:bg-slate-50');
                    element.title = link.name;
                    element.style.pointerEvents = 'auto';
                    element.onclick = null; // Remove any disabled click handlers
                } else {
                    // Student is not enrolled - disable navigation
                    console.log(`Disabling navigation for ${link.id}`);
                    element.classList.add('opacity-50', 'cursor-not-allowed', 'pointer-events-none');
                    element.classList.remove('hover:text-slate-800', 'hover:bg-slate-50');
                    element.title = `Join a class to access ${link.name}`;
                    element.style.pointerEvents = 'none';
                    
                    // Prevent navigation by overriding click behavior
                    element.onclick = function(e) {
                        e.preventDefault();
                        alert('Please join a class first to access this feature.');
                        return false;
                    };
                }
            });
        }

        // Function to update notification button state based on enrollment
        function updateNotificationButtonState() {
            const notificationButton = document.getElementById('notificationButton');
            if (!notificationButton) return;
            
            // Always keep notifications enabled
            notificationButton.classList.remove('opacity-50', 'cursor-not-allowed');
            notificationButton.classList.add('hover:text-slate-800', 'hover:bg-slate-50');
            notificationButton.title = 'Notifications';
        }

        // Initialize notification system when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for enrollment check to complete before initializing notification system
            const initNotificationSystem = () => {
                if (window.studentEnrollmentCheck && window.studentEnrollmentCheck.enrollmentStatus !== undefined) {
                    console.log('Enrollment check completed, initializing notification system');
                    window.notificationSystem = new NotificationSystem();
                    updateNotificationButtonState();
                    updateNavigationState();
                } else {
                    console.log('Enrollment check not ready, waiting...');
                    // Wait a bit more for enrollment check to complete
                    setTimeout(initNotificationSystem, 500);
                }
            };
            
            // Start the initialization process
            setTimeout(initNotificationSystem, 1000);
            
            // Additional safety check - ensure navigation state is updated after page load
            setTimeout(() => {
                console.log('Safety check - updating navigation state');
                updateNavigationState();
            }, 2000);
            
            // Listen for page visibility changes (when user returns from another page)
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    console.log('Page became visible - updating navigation state');
                    setTimeout(() => {
                        updateNavigationState();
                        updateNotificationButtonState();
                    }, 100);
                }
            });
            
            // Listen for window focus (when user switches tabs and comes back)
            window.addEventListener('focus', function() {
                console.log('Window focused - updating navigation state');
                setTimeout(() => {
                    updateNavigationState();
                    updateNotificationButtonState();
                }, 100);
            });
            
            // Student avatar loading disabled - avatars removed from UI
            // setTimeout(() => { loadTopicStudentData(); }, 2000);
        });

        // Function to load real student data for each topic - REMOVED
        // Student avatars have been removed from the UI
        async function loadTopicStudentData() {
            // This function is no longer needed as student avatars have been removed
            console.log('Student avatar loading disabled - avatars removed from UI');
        }

        // Function to load students for a specific topic - REMOVED
        // Student avatars have been removed from the UI
        async function loadStudentsForTopic(topicId, topicName) {
            // This function is no longer needed as student avatars have been removed
            console.log(`Student avatar loading disabled for ${topicName} - avatars removed from UI`);
        }

        // Function to display real student data - REMOVED
        // Student avatars have been removed from the UI
        function displayStudentsForTopic(topicId, students) {
            // This function is no longer needed as student avatars have been removed
            console.log(`Student avatar display disabled for ${topicId} - avatars removed from UI`);
        }

        // Manual function to refresh student data (for debugging) - REMOVED
        // Student avatars have been removed from the UI
        window.refreshStudentData = function() {
            console.log('Student data refresh disabled - avatars removed from UI');
        };

        // Function to display generic students as fallback - REMOVED
        // Student avatars have been removed from the UI
        function displayGenericStudents(topicId) {
            // This function is no longer needed as student avatars have been removed
            console.log(`Generic student display disabled for ${topicId} - avatars removed from UI`);
        }
    </script>
    
    <script>
        // Enrollment check function
        async function checkEnrollmentAndNavigate(url) {
            if (window.studentEnrollmentCheck) {
                if (window.studentEnrollmentCheck.enrollmentStatus && window.studentEnrollmentCheck.enrollmentStatus.has_approved_enrollment) {
                    // Student is enrolled, check if topic is locked
                    const topicId = extractTopicIdFromUrl(url);
                    
                    if (topicId) {
                        const topicCheck = await window.studentEnrollmentCheck.checkTopicLock(topicId);
                        
                        if (topicCheck.needs_enrollment) {
                            // Student needs enrollment, show enrollment modal
                            window.studentEnrollmentCheck.showEnrollmentRequiredModal();
                            return;
                        } else if (topicCheck.is_locked) {
                            // Topic is locked, show modal
                            showTopicLockedModal(topicCheck.message);
                            return;
                        }
                    }
                    // Topic is not locked, allow navigation
                    window.location.href = url;
                } else {
                    // Student is not enrolled, show modal
                    window.studentEnrollmentCheck.showEnrollmentRequiredModal();
                }
            } else {
                // Fallback - show alert
                alert('You need to join a class to access topics and quizzes. Please ask your teacher for the class code.');
            }
        }

        // Extract topic ID from URL
        function extractTopicIdFromUrl(url) {
            const match = url.match(/topics\/([^\/]+)\.html/);
            return match ? match[1] : null;
        }

        // Show topic locked modal
        function showTopicLockedModal(message) {
            Swal.fire({
                title: 'Topic Locked',
                text: message,
                icon: 'lock',
                confirmButtonText: 'OK',
                confirmButtonColor: '#ef4444',
                background: '#ffffff',
                customClass: {
                    popup: 'rounded-2xl',
                    title: 'text-slate-800',
                    content: 'text-slate-600'
                }
            });
        }

        // Interactive functions for the dashboard
        function showComingSoon() {
            Swal.fire({
                title: 'Coming Soon!',
                text: 'This topic is currently under development. Stay tuned for updates!',
                icon: 'info',
                confirmButtonText: 'Got it!',
                confirmButtonColor: '#6366f1',
                background: '#ffffff',
                customClass: {
                    popup: 'rounded-2xl',
                    title: 'text-slate-800',
                    content: 'text-slate-600'
                }
            });
        }

        // Enhanced progress data loading with caching and retry logic
        class ProgressManager {
            constructor() {
                this.cache = new Map();
                this.cacheTimeout = 30000; // 30 seconds
                this.retryAttempts = 3;
                this.retryDelay = 1000; // 1 second
                this.isLoading = false;
                this.lastUpdate = null;
            }

            async loadProgressData(forceRefresh = false) {
                if (this.isLoading && !forceRefresh) {
                    console.log('Progress data already loading, skipping...');
                    return;
                }

                this.isLoading = true;
                const cacheKey = 'progress_data';
                
                // Check cache first
                if (!forceRefresh && this.cache.has(cacheKey)) {
                    const cached = this.cache.get(cacheKey);
                    if (Date.now() - cached.timestamp < this.cacheTimeout) {
                        console.log('Using cached progress data');
                        this.updateUI(cached.data);
                        this.isLoading = false;
                        return cached.data;
                    }
                }

                console.log('Loading fresh progress data...');
                
                for (let attempt = 1; attempt <= this.retryAttempts; attempt++) {
                    try {
                        const response = await fetch('php/get-progress.php', {
                            credentials: 'include',
                            cache: 'no-store',
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                                'Cache-Control': 'no-cache'
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }

                        const text = await response.text();
                        console.log('Raw response:', text);
                        
                        let data;
                        try {
                            data = JSON.parse(text);
                        } catch (parseError) {
                            console.error('Invalid JSON response:', text);
                            throw new Error('Server returned invalid JSON response');
                        }
                        
                        if (data.success) {
                            console.log('Progress data loaded successfully');
                            console.log('Debug info:', data.debug);
                            
                            // Cache the data
                            this.cache.set(cacheKey, {
                                data: data,
                                timestamp: Date.now()
                            });
                            
                            this.lastUpdate = new Date();
                            this.updateUI(data);
                            this.isLoading = false;
                            
                            // Show success notification if this was a retry
                            if (attempt > 1) {
                                this.showNotification('Progress data loaded successfully!', 'success');
                            }
                            
                            return data;
                        } else {
                            throw new Error(data.message || 'Failed to load progress data');
                        }
                    } catch (error) {
                        console.error(`Attempt ${attempt} failed:`, error);
                        
                        if (attempt === this.retryAttempts) {
                            console.error('All retry attempts failed');
                            this.handleProgressError(error);
                            this.isLoading = false;
                            return null;
                        } else {
                            console.log(`Retrying in ${this.retryDelay}ms...`);
                            await this.delay(this.retryDelay);
                            this.retryDelay *= 2; // Exponential backoff
                        }
                    }
                }
            }

            updateUI(data) {
                try {
                    updateProgressDisplay(data);
                    updateTopicCards(data.topics);
                    updateUserStats(data.user_stats);
                    updateSecondQuarterProgress(data);
                    this.updateLastSyncIndicator();
                } catch (error) {
                    console.error('Error updating UI:', error);
                }
            }

            handleProgressError(error) {
                console.error('Progress loading failed:', error);
                
                // Show user-friendly error message
                this.showNotification('Unable to load progress data. Please check your connection.', 'error');
                
                // Fallback to default values
                const fallbackData = {
                    overall_progress: 0,
                    completed_lessons: 0,
                    total_lessons: 35,
                    completed_topics: 0,
                    total_topics: 10,
                    topics: {},
                    user_stats: {
                        total_score: 0,
                        completed_lessons: 0
                    }
                };
                
                this.updateUI(fallbackData);
            }

            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
                    type === 'success' ? 'bg-green-500 text-white' :
                    type === 'error' ? 'bg-red-500 text-white' :
                    'bg-blue-500 text-white'
                }`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            updateLastSyncIndicator() {
                const indicator = document.getElementById('lastSyncIndicator');
                if (indicator && this.lastUpdate) {
                    const timeString = this.lastUpdate.toLocaleTimeString();
                    indicator.textContent = `Last updated: ${timeString}`;
                    indicator.style.display = 'block';
                }
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // Method to refresh progress data
            async refresh() {
                console.log('Manually refreshing progress data...');
                return await this.loadProgressData(true);
            }

            // Method to clear cache
            clearCache() {
                this.cache.clear();
                console.log('Progress cache cleared');
            }
        }

        // Initialize progress manager
        const progressManager = new ProgressManager();

        // Legacy function for backward compatibility
        async function loadProgressData(forceRefresh = false) {
            return await progressManager.loadProgressData(forceRefresh);
        }

        // Enhanced progress display with better animations and loading states
        function updateProgressDisplay(data) {
            const progressBar = document.getElementById('overallProgress');
            const progressText = document.getElementById('overallProgressText');
            const progressLabel = document.getElementById('progressLabel');
            const courseProgressBar = document.getElementById('courseProgressBar');
            const courseProgressText = document.getElementById('courseProgressText');
            
            if (progressBar && progressText) {
                // Add loading state
                progressBar.classList.add('loading');
                
                // Animate overall progress bar with easing
                let progress = 0;
                const targetProgress = data.overall_progress || 0;
                const duration = 2000; // 2 seconds
                const startTime = Date.now();
                
                const animateProgress = () => {
                    const elapsed = Date.now() - startTime;
                    const progressRatio = Math.min(elapsed / duration, 1);
                    
                    // Easing function (ease-out)
                    const easeOut = 1 - Math.pow(1 - progressRatio, 3);
                    progress = Math.round(targetProgress * easeOut);
                    
                    progressBar.style.width = progress + '%';
                    progressText.textContent = progress + '%';
                    
                    // Update the label inside the progress bar
                    if (progressLabel) {
                        progressLabel.textContent = progress + '%';
                    }
                    
                    // Add visual feedback based on progress level
                    if (progress >= 80) {
                        progressBar.classList.remove('bg-indigo-500');
                        progressBar.classList.add('bg-green-500');
                    } else if (progress >= 60) {
                        progressBar.classList.remove('bg-indigo-500', 'bg-green-500');
                        progressBar.classList.add('bg-blue-500');
                    } else if (progress >= 40) {
                        progressBar.classList.remove('bg-indigo-500', 'bg-green-500', 'bg-blue-500');
                        progressBar.classList.add('bg-yellow-500');
                    } else {
                        progressBar.classList.remove('bg-indigo-500', 'bg-green-500', 'bg-blue-500', 'bg-yellow-500');
                        progressBar.classList.add('bg-indigo-500');
                    }
                    
                    if (progressRatio < 1) {
                        requestAnimationFrame(animateProgress);
                    } else {
                        progressBar.classList.remove('loading');
                        // Add completion animation
                        if (targetProgress === 100) {
                            progressBar.classList.add('progress-complete');
                            setTimeout(() => {
                                progressBar.classList.remove('progress-complete');
                            }, 1000);
                        }
                    }
                };
                
                requestAnimationFrame(animateProgress);
            }
            
            if (courseProgressBar && courseProgressText) {
                // Animate course progress bar
                const courseProgress = data.topic_progress || 0;
                const currentWidth = parseFloat(courseProgressBar.style.width) || 0;
                
                // Smooth transition to new width
                courseProgressBar.style.transition = 'width 1.5s ease-out';
                courseProgressBar.style.width = courseProgress + '%';
                
                // Update text with animation
                const currentLessons = data.completed_topics || 0;
                const totalLessons = data.total_topics || 10;
                
                // Animate the text change
                let currentText = courseProgressText.textContent;
                const newText = `${currentLessons} of ${totalLessons} Lessons Completed`;
                
                if (currentText !== newText) {
                    courseProgressText.style.opacity = '0.5';
                    setTimeout(() => {
                        courseProgressText.textContent = newText;
                        courseProgressText.style.opacity = '1';
                    }, 200);
                }
            }
            
            // Update additional progress indicators
            updateProgressIndicators(data);
        }

        // Update additional progress indicators
        function updateProgressIndicators(data) {
            // Update lesson completion rate
            const lessonRate = data.total_lessons > 0 ? 
                Math.round((data.completed_lessons / data.total_lessons) * 100) : 0;
            
            // Update topic completion rate
            const topicRate = data.total_topics > 0 ? 
                Math.round((data.completed_topics / data.total_topics) * 100) : 0;
            
            // Add progress badges if they don't exist
            addProgressBadges(lessonRate, topicRate);
        }

        // Add progress badges for visual feedback
        function addProgressBadges(lessonRate, topicRate) {
            const progressContainer = document.querySelector('#progress .bg-gradient-to-br');
            if (!progressContainer) return;
            
            // Remove existing badges
            const existingBadges = progressContainer.querySelectorAll('.progress-badge');
            existingBadges.forEach(badge => badge.remove());
            
            // Create badges container
            const badgesContainer = document.createElement('div');
            badgesContainer.className = 'flex space-x-2 mt-4';
            
            // Lesson completion badge
            if (lessonRate > 0) {
                const lessonBadge = document.createElement('div');
                
                badgesContainer.appendChild(lessonBadge);
            }
            
            // Topic completion badge
            if (topicRate > 0) {
                const topicBadge = document.createElement('div');
                
                badgesContainer.appendChild(topicBadge);
            }
            
            // Add badges to container
            if (badgesContainer.children.length > 0) {
                progressContainer.appendChild(badgesContainer);
            }
        }

        // Update topic cards with completion status
        function updateTopicCards(topics) {
            console.log('Updating topic cards with data:', topics);
            Object.keys(topics).forEach(topic => {
                const topicData = topics[topic];
                console.log(`Processing topic: ${topic}`, topicData);

                // Find topic card by looking for the topic name in the onclick attribute
                let topicCard = document.querySelector(`[onclick*="${topic}.html"]`);

                // If not found, try alternative selectors for specific topics
                if (!topicCard) {
                    if (topic === 'functions') {
                        topicCard = document.querySelector('[onclick*="topics/functions.html"]');
                    } else if (topic === 'evaluating-functions') {
                        topicCard = document.querySelector('[onclick*="topics/evaluating-functions.html"]');
                    } else if (topic === 'operations-on-functions') {
                        topicCard = document.querySelector('[onclick*="topics/operations-on-functions.html"]');
                    } else if (topic === 'solving-real-life-problems') {
                        topicCard = document.querySelector('[onclick*="topics/solving-real-life-problems.html"]');
                    } else if (topic === 'rational-functions') {
                        topicCard = document.querySelector('[onclick*="topics/rational-functions.html"]');
                    } else if (topic === 'solving-rational-equations-inequalities') {
                        topicCard = document.querySelector('[onclick*="topics/solving-rational-equations-inequalities.html"]');
                    } else if (topic === 'representations-of-rational-functions') {
                        topicCard = document.querySelector('[onclick*="topics/representations-of-rational-functions.html"]');
                    } else if (topic === 'domain-range-rational-functions') {
                        topicCard = document.querySelector('[onclick*="topics/domain-range-rational-functions.html"]');
                    } else if (topic === 'one-to-one-functions') {
                        topicCard = document.querySelector('[onclick*="topics/one-to-one-functions.html"]');
                    } else if (topic === 'domain-range-inverse-functions') {
                        topicCard = document.querySelector('[onclick*="topics/domain-range-inverse-functions.html"]');
                    }
                }

                console.log(`Found topic card for ${topic}:`, topicCard);

                if (topicCard && topicData) {
                    console.log(`Updating topic card for ${topic}:`, topicData);

                    // Find the primary action button inside the card
                    const actionButton = topicCard.querySelector('button');

                    if (topicData.completed) {
                        // Mark topic as completed visually
                        topicCard.classList.add('topic-completed');

                        // Update button to show Completed
                        if (actionButton) {
                            actionButton.innerHTML = '<i class="fas fa-check mr-2"></i>Completed';
                            actionButton.className = 'bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors';
                            actionButton.disabled = false;
                        }

                        // Add or update a small "Completed" badge near the badges row if possible
                        const badgesRow = topicCard.querySelector('.flex.items-center.space-x-4');
                        if (badgesRow && !badgesRow.querySelector('.mathease-completed-badge')) {
                            const completedBadge = document.createElement('span');
                            completedBadge.className = 'mathease-completed-badge bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium';
                            completedBadge.textContent = 'Completed';
                            badgesRow.appendChild(completedBadge);
                        }
                    } else if (topicData.lessons_completed > 0) {
                        // In-progress state: update button to Continue and show lesson progress
                        if (actionButton) {
                            actionButton.innerHTML = '<i class="fas fa-play mr-2"></i>Continue';
                            actionButton.className = 'bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors';
                            actionButton.disabled = false;
                        }

                        const badgesRow = topicCard.querySelector('.flex.items-center.space-x-4');
                        if (badgesRow) {
                            // Either update an existing progress badge or add one
                            let progressBadge = badgesRow.querySelector('.mathease-progress-badge');
                            if (!progressBadge) {
                                progressBadge = document.createElement('span');
                                progressBadge.className = 'mathease-progress-badge bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium';
                                badgesRow.appendChild(progressBadge);
                            }
                            progressBadge.textContent = `${topicData.lessons_completed}/${topicData.total_lessons} Lessons`;
                        }
                    } else {
                        // Not started: keep default button label but ensure no stale badges remain
                        if (actionButton && actionButton.textContent.trim() !== 'Start Learning') {
                            actionButton.innerHTML = '<i class="fas fa-play mr-3"></i>Start Learning';
                            actionButton.className = 'bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-sm font-medium transition-colors';
                            actionButton.disabled = false;
                        }

                        const progressBadge = topicCard.querySelector('.mathease-progress-badge');
                        if (progressBadge) progressBadge.remove();
                    }
                }
            });
        }

        // Update user stats display
        function updateUserStats(userStats) {
            console.log('Updating user stats:', userStats);
            const completedLessonsEl = document.getElementById('completedLessons');
            
            if (completedLessonsEl) {
                const completedCount = userStats.completed_lessons || 0;
                console.log(`Setting completed lessons to: ${completedCount}`);
                completedLessonsEl.textContent = completedCount;
            }
        }

        // Load and display achievements count
        async function loadAchievementsCount() {
            try {
                console.log('🔄 Loading achievements count...');
                
                // First get the current user ID
                const userResponse = await fetch('php/user.php', {
                    credentials: 'include',
                    cache: 'no-store',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                
                if (!userResponse.ok) {
                    console.error('❌ Failed to get user data for achievements:', userResponse.status);
                    return;
                }
                
                const userData = await userResponse.json();
                if (!userData.success || !userData.user) {
                    console.error('❌ No user data available for achievements');
                    return;
                }
                
                const studentId = userData.user.id;
                console.log('👤 Loading achievements for student ID:', studentId);
                
                // Now get the student's badges
                const formData = new FormData();
                formData.append('action', 'get_student_badges');
                formData.append('student_id', studentId);
                
                const response = await fetch('php/badge-management.php', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include',
                    cache: 'no-store',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('🏆 Badges response:', data);
                    
                    if (data.success && data.badges) {
                        const badgesCount = data.badges.length;
                        const badgesEarnedEl = document.getElementById('badgesEarned');
                        if (badgesEarnedEl) {
                            badgesEarnedEl.textContent = badgesCount;
                            console.log(`✅ Updated achievements count to: ${badgesCount}`);
                            
                            // Add visual feedback for achievement count update
                            badgesEarnedEl.style.transform = 'scale(1.1)';
                            badgesEarnedEl.style.transition = 'transform 0.3s ease';
                            setTimeout(() => {
                                badgesEarnedEl.style.transform = 'scale(1)';
                            }, 300);
                        } else {
                            console.error('❌ badgesEarned element not found in DOM');
                        }
                    } else {
                        console.log('⚠️ No badges found or error in response');
                        const badgesEarnedEl = document.getElementById('badgesEarned');
                        if (badgesEarnedEl) {
                            badgesEarnedEl.textContent = '0';
                            console.log('✅ Set achievements count to 0 (no badges)');
                        }
                    }
                } else {
                    console.error('❌ Failed to load achievements:', response.status, response.statusText);
                    const badgesEarnedEl = document.getElementById('badgesEarned');
                    if (badgesEarnedEl) {
                        badgesEarnedEl.textContent = '0';
                        console.log('✅ Set achievements count to 0 (API error)');
                    }
                }
            } catch (error) {
                console.error('❌ Error loading achievements:', error);
                const badgesEarnedEl = document.getElementById('badgesEarned');
                if (badgesEarnedEl) {
                    badgesEarnedEl.textContent = '0';
                    console.log('✅ Set achievements count to 0 (exception)');
                }
            }
        }

        // Load and display class information
        async function loadClassInformation() {
            try {
                console.log('Loading class information...');
                
                const response = await fetch('php/student-enrollment.php?action=get_enrollment_status', {
                    credentials: 'include',
                    cache: 'no-store'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Class information response:', data);
                    
                    if (data.success && data.enrollment_status && data.enrollment_status.has_approved_enrollment) {
                        const enrollment = data.enrollment_status.approved_enrollment;
                        const classInfoBanner = document.getElementById('classInfoBanner');
                        const className = document.getElementById('className');
                        const classDescription = document.getElementById('classDescription');
                        const teacherName = document.getElementById('teacherName');
                        
                        if (classInfoBanner && className && classDescription && teacherName) {
                            // Show the class information banner
                            classInfoBanner.classList.remove('hidden');
                            
                            // Update class information
                            className.textContent = enrollment.class_name || 'Class Information';
                            classDescription.textContent = `You are enrolled in ${enrollment.class_name || 'a class'}`;
                            const fullTeacherName = (enrollment.teacher_first_name && enrollment.teacher_last_name) 
                                ? `${enrollment.teacher_first_name} ${enrollment.teacher_last_name}` 
                                : (enrollment.teacher_name || 'Teacher');
                            teacherName.textContent = fullTeacherName;
                            
                            console.log('Class information displayed:', {
                                className: enrollment.class_name,
                                teacher: `${enrollment.teacher_first_name} ${enrollment.teacher_last_name}`
                            });
                        }
                    } else {
                        console.log('No approved enrollment found');
                        const classInfoBanner = document.getElementById('classInfoBanner');
                        if (classInfoBanner) {
                            classInfoBanner.classList.add('hidden');
                        }
                    }
                } else {
                    console.error('Failed to load class information:', response.status);
                }
            } catch (error) {
                console.error('Error loading class information:', error);
            }
        }

        // Update 2nd Quarter progress
        function updateSecondQuarterProgress(data) {
            const secondQuarterProgress = document.getElementById('secondQuarterProgress');
            const secondQuarterProgressText = document.getElementById('secondQuarterProgressText');
            const secondQuarterProgressLabel = document.getElementById('secondQuarterProgressLabel');
            
            if (secondQuarterProgress && secondQuarterProgressText) {
                // Calculate 2nd Quarter progress (lessons 11-14)
                const secondQuarterLessons = ['simple-interest', 'compound-interest', 'simple-and-compound-values', 'solving-interest-problems'];
                let completedSecondQuarterLessons = 0;
                
                if (data.topics) {
                    secondQuarterLessons.forEach(lesson => {
                        if (data.topics[lesson] && data.topics[lesson].completed) {
                            completedSecondQuarterLessons++;
                        }
                    });
                }
                
                const secondQuarterProgressPercentage = Math.round((completedSecondQuarterLessons / secondQuarterLessons.length) * 100);
                
                // Animate progress bar
                secondQuarterProgress.style.width = secondQuarterProgressPercentage + '%';
                secondQuarterProgressText.textContent = secondQuarterProgressPercentage + '%';
                
                if (secondQuarterProgressLabel) {
                    secondQuarterProgressLabel.textContent = secondQuarterProgressPercentage + '%';
                }
                
                // Update progress bar color based on percentage
                if (secondQuarterProgressPercentage >= 80) {
                    secondQuarterProgress.className = 'bg-green-500 h-6 rounded-full transition-all duration-1000 shadow-sm flex items-center justify-end pr-2';
                } else if (secondQuarterProgressPercentage >= 60) {
                    secondQuarterProgress.className = 'bg-blue-500 h-6 rounded-full transition-all duration-1000 shadow-sm flex items-center justify-end pr-2';
                } else if (secondQuarterProgressPercentage >= 40) {
                    secondQuarterProgress.className = 'bg-yellow-500 h-6 rounded-full transition-all duration-1000 shadow-sm flex items-center justify-end pr-2';
                } else {
                    secondQuarterProgress.className = 'bg-green-500 h-6 rounded-full transition-all duration-1000 shadow-sm flex items-center justify-end pr-2';
                }
                
                console.log(`2nd Quarter progress: ${secondQuarterProgressPercentage}% (${completedSecondQuarterLessons}/${secondQuarterLessons.length} lessons completed)`);
            }
        }

        // Enhanced refresh functionality with loading states
        function toggleAutoRefresh() {
            const isEnabled = realTimeUpdater.toggleAutoRefresh();
            const toggleButton = document.getElementById('autoRefreshToggle');
            
            if (toggleButton) {
                if (isEnabled) {
                    toggleButton.className = 'bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center space-x-2';
                    toggleButton.title = 'Auto-refresh enabled (click to disable)';
                } else {
                    toggleButton.className = 'bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center space-x-2';
                    toggleButton.title = 'Auto-refresh disabled (click to enable)';
                }
            }
            
            // Show notification
            const message = isEnabled ? 'Auto-refresh enabled' : 'Auto-refresh disabled';
            progressManager.showNotification(message, 'info');
        }

        // Manual function to refresh achievements count
        async function refreshAchievementsCount() {
            console.log('🔄 Manually refreshing achievements count...');
            try {
                await loadAchievementsCount();
                progressManager.showNotification('Achievements count refreshed!', 'success');
            } catch (error) {
                console.error('❌ Failed to refresh achievements:', error);
                progressManager.showNotification('Failed to refresh achievements', 'error');
            }
        }

        // Global function to refresh achievements (for external calls)
        window.refreshAchievements = refreshAchievementsCount;

        // Function to validate achievements count accuracy
        async function validateAchievementsCount() {
            try {
                console.log('🔍 Validating achievements count accuracy...');
                
                // Get current displayed count
                const badgesEarnedEl = document.getElementById('badgesEarned');
                const displayedCount = badgesEarnedEl ? parseInt(badgesEarnedEl.textContent) || 0 : 0;
                
                // Get actual count from database
                await loadAchievementsCount();
                
                const actualCount = badgesEarnedEl ? parseInt(badgesEarnedEl.textContent) || 0 : 0;
                
                console.log(`📊 Achievements validation: Displayed=${displayedCount}, Actual=${actualCount}`);
                
                if (displayedCount !== actualCount) {
                    console.warn(`⚠️ Achievements count mismatch detected! Displayed: ${displayedCount}, Actual: ${actualCount}`);
                    progressManager.showNotification('Achievements count was updated!', 'info');
                } else {
                    console.log('✅ Achievements count is accurate');
                }
                
                return actualCount;
            } catch (error) {
                console.error('❌ Error validating achievements count:', error);
                return 0;
            }
        }

        // Global function to validate achievements (for debugging)
        window.validateAchievements = validateAchievementsCount;

        // Function to handle achievement updates (called when badges are earned)
        async function handleAchievementUpdate() {
            console.log('🎉 Achievement update detected, refreshing count...');
            try {
                await loadAchievementsCount();
                progressManager.showNotification('New achievement earned! 🏆', 'success');
            } catch (error) {
                console.error('❌ Failed to update achievements:', error);
            }
        }

        // Global function to handle achievement updates (for external calls)
        window.handleAchievementUpdate = handleAchievementUpdate;

        // Function to force refresh achievements with visual feedback
        async function forceRefreshAchievements() {
            console.log('🔄 Force refreshing achievements...');
            const badgesEarnedEl = document.getElementById('badgesEarned');
            
            if (badgesEarnedEl) {
                // Add loading animation
                badgesEarnedEl.style.opacity = '0.5';
                badgesEarnedEl.style.transform = 'scale(0.9)';
            }
            
            try {
                await loadAchievementsCount();
                progressManager.showNotification('Achievements refreshed!', 'success');
            } catch (error) {
                console.error('❌ Force refresh failed:', error);
                progressManager.showNotification('Failed to refresh achievements', 'error');
            } finally {
                if (badgesEarnedEl) {
                    // Remove loading animation
                    badgesEarnedEl.style.opacity = '1';
                    badgesEarnedEl.style.transform = 'scale(1)';
                }
            }
        }

        // Global function to force refresh achievements
        window.forceRefreshAchievements = forceRefreshAchievements;

        // Enhanced refresh button with loading state
        async function refreshProgressData() {
            console.log('Manually refreshing progress data...');
            const refreshButton = document.getElementById('refreshButton');
            const refreshIcon = refreshButton?.querySelector('i');
            
            if (refreshButton && refreshIcon) {
                // Add loading state
                refreshButton.disabled = true;
                refreshIcon.classList.add('refresh-loading');
                refreshButton.classList.add('opacity-75');
                
                try {
                    await progressManager.refresh();
                    await loadAchievementsCount(); // Also refresh achievements
                    await loadClassInformation(); // Also refresh class information
                    progressManager.showNotification('Progress data and achievements refreshed successfully!', 'success');
                } catch (error) {
                    console.error('Manual refresh failed:', error);
                    progressManager.showNotification('Failed to refresh progress data', 'error');
                } finally {
                    // Remove loading state
                    refreshButton.disabled = false;
                    refreshIcon.classList.remove('refresh-loading');
                    refreshButton.classList.remove('opacity-75');
                }
            } else {
                // Fallback to legacy function
                await loadProgressData(true);
                await loadAchievementsCount();
            }
        }

        // Override the progressManager.refresh method to include button state
        const originalRefresh = progressManager.refresh;
        progressManager.refresh = async function() {
            const refreshButton = document.getElementById('refreshButton');
            const refreshIcon = refreshButton?.querySelector('i');
            
            if (refreshButton && refreshIcon) {
                refreshButton.disabled = true;
                refreshIcon.classList.add('refresh-loading');
            }
            
            try {
                const result = await originalRefresh.call(this);
                return result;
            } finally {
                if (refreshButton && refreshIcon) {
                    refreshButton.disabled = false;
                    refreshIcon.classList.remove('refresh-loading');
                }
            }
        };

        // Function to manually set completed lessons count (for testing)
        function setCompletedLessonsCount(count) {
            console.log(`Manually setting completed lessons to: ${count}`);
            const completedLessonsEl = document.getElementById('completedLessons');
            if (completedLessonsEl) {
                completedLessonsEl.textContent = count;
                console.log('Completed lessons count updated successfully');
            } else {
                console.log('Completed lessons element not found');
            }
        }

        // Function to check current session status
        async function checkSessionStatus() {
            try {
                console.log('Checking session status...');
                const response = await fetch('php/user.php', {
                    credentials: 'include',
                    cache: 'no-store'
                });
                
                console.log('User API response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('User data:', data);
                    if (data.success && data.user) {
                        console.log('Current user:', data.user.first_name, data.user.last_name, '(ID:', data.user.id, ')');
                        return data.user.id;
                    }
                } else {
                    console.log('User API failed with status:', response.status);
                }
            } catch (error) {
                console.error('Error checking session:', error);
            }
            return null;
        }

        // Test function to manually apply completion styling (for debugging)
        function testTopicCompletion(topicName = 'functions') {
            console.log(`Testing completion styling for ${topicName}`);
            const topicCard = document.querySelector(`[onclick*="topics/${topicName}.html"]`);
            if (topicCard) {
                console.log('Found topic card, applying completion styling');
                topicCard.classList.add('topic-completed');
                
                // Update status text
                const statusSpans = topicCard.querySelectorAll('span');
                statusSpans.forEach(span => {
                    if (span.textContent === 'Available') {
                        span.textContent = 'Completed';
                        span.className = 'text-sm text-green-200';
                    }
                    if (span.textContent === 'Ready to Start') {
                        span.textContent = 'Completed';
                        span.className = 'text-sm font-medium text-green-200';
                    }
                });
                
                // Update button
                const buttons = topicCard.querySelectorAll('div');
                buttons.forEach(button => {
                    if (button.textContent.includes('Start Learning')) {
                        button.innerHTML = '<i class="fas fa-check mr-2"></i>Completed';
                        button.className = 'bg-green-500 hover:bg-green-600 px-6 py-3 rounded-xl text-sm font-bold transition-all duration-300';
                    }
                });
                
                // Update status dot
                const statusDot = topicCard.querySelector('.bg-green-400');
                if (statusDot) {
                    statusDot.className = 'w-3 h-3 bg-green-500 rounded-full';
                }
                
                console.log('Completion styling applied successfully');
            } else {
                console.log('Topic card not found');
            }
        }

        // Real-time progress updates and auto-refresh
        class RealTimeProgressUpdater {
            constructor() {
                this.autoRefreshInterval = null;
                this.autoRefreshEnabled = true;
                this.refreshInterval = 60000; // 1 minute
                this.isVisible = true;
                this.lastActivity = Date.now();
            }

            start() {
                console.log('Starting real-time progress updates...');
                this.setupVisibilityListener();
                this.setupActivityListener();
                this.startAutoRefresh();
            }

            stop() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                    this.autoRefreshInterval = null;
                }
                console.log('Real-time progress updates stopped');
            }

            setupVisibilityListener() {
                document.addEventListener('visibilitychange', () => {
                    this.isVisible = !document.hidden;
                    if (this.isVisible) {
                        console.log('Page became visible, refreshing progress...');
                        this.refreshProgress();
                        this.startAutoRefresh();
                    } else {
                        console.log('Page hidden, pausing auto-refresh');
                        this.stopAutoRefresh();
                    }
                });
            }

            setupActivityListener() {
                // Track user activity to determine if auto-refresh should be active
                const activityEvents = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
                
                activityEvents.forEach(event => {
                    document.addEventListener(event, () => {
                        this.lastActivity = Date.now();
                    }, true);
                });

                // Check for inactivity every 5 minutes
                setInterval(() => {
                    const inactiveTime = Date.now() - this.lastActivity;
                    if (inactiveTime > 300000) { // 5 minutes
                        console.log('User inactive, reducing refresh frequency');
                        this.refreshInterval = 300000; // 5 minutes
                    } else {
                        this.refreshInterval = 60000; // 1 minute
                    }
                }, 300000);
            }

            startAutoRefresh() {
                if (!this.autoRefreshEnabled || !this.isVisible) return;
                
                this.stopAutoRefresh(); // Clear any existing interval
                
                this.autoRefreshInterval = setInterval(() => {
                    if (this.isVisible) {
                        console.log('Auto-refreshing progress data...');
                        this.refreshProgress();
                    }
                }, this.refreshInterval);
                
                console.log(`Auto-refresh started (${this.refreshInterval / 1000}s interval)`);
            }

            stopAutoRefresh() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                    this.autoRefreshInterval = null;
                }
            }

            async refreshProgress() {
                try {
                    await progressManager.loadProgressData(true);
                    await loadAchievementsCount();
                    await loadClassInformation();
                    
                    // Validate achievements count accuracy
                    await validateAchievementsCount();
                } catch (error) {
                    console.error('Auto-refresh failed:', error);
                }
            }

            toggleAutoRefresh() {
                this.autoRefreshEnabled = !this.autoRefreshEnabled;
                if (this.autoRefreshEnabled) {
                    this.startAutoRefresh();
                    console.log('Auto-refresh enabled');
                } else {
                    this.stopAutoRefresh();
                    console.log('Auto-refresh disabled');
                }
                return this.autoRefreshEnabled;
            }
        }

        // Initialize real-time updater
        const realTimeUpdater = new RealTimeProgressUpdater();

        // Add smooth scrolling and animations
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Dashboard loaded, starting progress data load...');
            
            // Check session status first
            const currentUserId = await checkSessionStatus();
            console.log('Current user ID from session check:', currentUserId);
            
            // Load real progress data
            await loadProgressData();
            
            // Load achievements count
            await loadAchievementsCount();
            
            // Load class information
            await loadClassInformation();
            
            // Student avatar loading disabled - avatars removed from UI
            // setTimeout(() => { loadTopicStudentData(); }, 1000);
            
            // Start real-time updates
            realTimeUpdater.start();

            // Add hover effects to topic cards
            const topicCards = document.querySelectorAll('[onclick*="topics/"]');
            topicCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                });
            });

            // Add click animations
            const clickableElements = document.querySelectorAll('[onclick]');
            clickableElements.forEach(element => {
                element.addEventListener('click', function(e) {
                    // Create ripple effect
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.classList.add('ripple');
                    
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });
        });

        // Add CSS for ripple effect and custom classes
        const style = document.createElement('style');
        style.textContent = `
            .ripple {
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                transform: scale(0);
                animation: ripple-animation 0.6s linear;
                pointer-events: none;
            }
            
            @keyframes ripple-animation {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            
            .hover\\:scale-102:hover {
                transform: scale(1.02);
            }
            
            .scale-102 {
                transform: scale(1.02);
            }
            
            .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            
            /* Locked topic styles - matches development topic layout */
            .topic-locked {
                cursor: not-allowed !important;
            }
            
            .topic-locked:hover {
                transform: none !important;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
            }
            
            /* Notification Modal Styles */
            .filter-tab.active {
                background-color: #6366f1 !important;
                color: white !important;
            }
            
            .filter-tab:not(.active) {
                background-color: transparent;
                color: #6b7280;
            }
            
            .filter-tab:not(.active):hover {
                background-color: rgba(99, 102, 241, 0.1);
                color: #6366f1;
            }
            
            /* Notification card animations */
            .notification-card {
                transition: all 0.3s ease;
            }
            
            .notification-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            }
            
            /* Modal animations */
            #notificationsModal {
                animation: fadeIn 0.3s ease-out;
            }
            
            #notificationsModal .bg-white {
                animation: slideUp 0.3s ease-out;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            @keyframes slideUp {
                from { 
                    opacity: 0;
                    transform: translateY(20px);
                }
                to { 
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Scrollbar styling for notification list */
            #allNotificationsList::-webkit-scrollbar {
                width: 6px;
            }
            
            #allNotificationsList::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 3px;
            }
            
            #allNotificationsList::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 3px;
            }
            
            #allNotificationsList::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }
            
            /* Topic completion styles - clean design */
            .topic-completed {
                position: relative;
                overflow: hidden;
                background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%) !important;
                border: 2px solid #22c55e !important;
                box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15) !important;
            }
            
            .topic-completed:hover {
                background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%) !important;
                box-shadow: 0 6px 16px rgba(34, 197, 94, 0.2) !important;
            }
            
            .topic-completed::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 0;
                height: 0;
                border-left: 40px solid transparent;
                border-top: 40px solid #22c55e;
                z-index: 10;
            }
            
            .topic-completed::after {
                content: '✓';
                position: absolute;
                top: 8px;
                right: 8px;
                color: white;
                font-weight: bold;
                font-size: 16px;
                z-index: 11;
                text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            }
            
            /* Completed topic text styling */
            .topic-completed h3 {
                color: #14532d !important;
            }
            
            .topic-completed .text-gray-600 {
                color: #16a34a !important;
            }
            
            .topic-completed .text-gray-900 {
                color: #14532d !important;
            }
            
            /* Completed topic button styling */
            .topic-completed .bg-orange-500 {
                background-color: #22c55e !important;
            }
            
            .topic-completed .bg-orange-500:hover {
                background-color: #16a34a !important;
            }
            
            /* Progress indicator updates */
            .progress-in-progress {
                background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);
            }
            
            .progress-completed {
                background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            }
            
            /* Enhanced progress bar animations */
            #overallProgress.loading {
                background: linear-gradient(90deg, #e5e7eb 0%, #d1d5db 50%, #e5e7eb 100%);
                background-size: 200% 100%;
                animation: loading-shimmer 2s infinite;
            }
            
            @keyframes loading-shimmer {
                0% { background-position: -200% 0; }
                100% { background-position: 200% 0; }
            }
            
            /* Progress level indicators */
            #overallProgress.progress-excellent {
                background: linear-gradient(90deg, #10b981 0%, #34d399 50%, #6ee7b7 100%);
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
            }
            
            #overallProgress.progress-good {
                background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);
                box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
            }
            
            #overallProgress.progress-fair {
                background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 50%, #fcd34d 100%);
                box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
            }
            
            #overallProgress.progress-needs-improvement {
                background: linear-gradient(90deg, #ef4444 0%, #f87171 50%, #fca5a5 100%);
                box-shadow: 0 0 8px rgba(239, 68, 68, 0.3);
            }
            
            /* Completion animation */
            #overallProgress.progress-complete {
                animation: progress-complete 1s ease-out;
            }
            
            @keyframes progress-complete {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(16, 185, 129, 0.6); }
                100% { transform: scale(1); }
            }
            
            /* Progress badges animation */
            .progress-badge {
                animation: badge-fade-in 0.5s ease-out;
            }
            
            @keyframes badge-fade-in {
                0% { opacity: 0; transform: translateY(10px); }
                100% { opacity: 1; transform: translateY(0); }
            }
            
            /* Refresh button loading state */
            .refresh-loading {
                animation: spin 1s linear infinite;
            }
            
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            
            /* Notification animations */
            .notification-enter {
                animation: notification-slide-in 0.3s ease-out;
            }
            
            .notification-exit {
                animation: notification-slide-out 0.3s ease-in;
            }
            
            @keyframes notification-slide-in {
                0% { transform: translateX(100%); opacity: 0; }
                100% { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes notification-slide-out {
                0% { transform: translateX(0); opacity: 1; }
                100% { transform: translateX(100%); opacity: 0; }
            }
            
            /* Enhanced topic card animations */
            .topic-card-updated {
                animation: topic-update-pulse 0.6s ease-out;
            }
            
            @keyframes topic-update-pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
                100% { transform: scale(1); }
            }
            
            /* Loading skeleton for progress bars */
            .progress-skeleton {
                background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
                background-size: 200% 100%;
                animation: skeleton-loading 1.5s infinite;
            }
            
            @keyframes skeleton-loading {
                0% { background-position: -200% 0; }
                100% { background-position: 200% 0; }
            }
            
            /* Welcome Character Styles */
            .welcome-character-container {
                position: relative;
                z-index: 10;
                display: flex;
                align-items: center;
                justify-content: flex-start;
            }
            
            .welcome-character {
                width: 220px;
                height: auto;
                filter: drop-shadow(0 15px 30px rgba(0,0,0,0.2));
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                cursor: pointer;
                animation: welcomeFloat 3s ease-in-out infinite, welcomeWiggle 2s ease-in-out infinite;
                pointer-events: auto;
            }
            
            
            
            @keyframes welcomeFloat {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                25% { transform: translateY(-8px) rotate(1deg); }
                50% { transform: translateY(-12px) rotate(0deg); }
                75% { transform: translateY(-8px) rotate(-1deg); }
            }
            
            @keyframes welcomeWiggle {
                0%, 100% { transform: rotate(0deg); }
                25% { transform: rotate(2deg); }
                50% { transform: rotate(0deg); }
                75% { transform: rotate(-2deg); }
            }
            
            /* Floating elements animations */
            .welcome-character-container > div:nth-child(2) { animation-delay: 0.5s; }
            .welcome-character-container > div:nth-child(3) { animation-delay: 1s; }
            .welcome-character-container > div:nth-child(4) { animation-delay: 1.5s; }
            
            /* Responsive adjustments for welcome character */
            @media (max-width: 768px) {
                .welcome-character { width: 150px; }
                .welcome-character-container { bottom: 20px; right: 20px; }
            }
            
            @media (max-width: 480px) {
                .welcome-character { width: 120px; }
                .welcome-character-container { bottom: 15px; right: 15px; }
            }
            
            /* Hero Layout Improvements */
            .hero-content {
                position: relative;
                z-index: 5;
            }
            
            .hero-cards {
                position: relative;
                z-index: 5;
                margin-top: 2rem;
                margin-left: auto;
                max-width: fit-content;
            }
            
            /* Make cards closer together */
            .hero-cards .grid {
                gap: 0.75rem;
            }
            
            .hero-cards .bg-white\/10 {
                margin-bottom: 0;
            }
            
            /* Responsive layout adjustments */
            @media (max-width: 1024px) {
                .welcome-character {
                    width: 180px;
                }
            }
            
            /* Better spacing for mobile */
            @media (max-width: 768px) {
                .hero-content h1 {
                    font-size: 2.5rem;
                }
                
                .hero-content p {
                    font-size: 1rem;
                }
                
                .welcome-character {
                    width: 160px;
                }
            }
            
            /* Mobile layout - stack everything vertically */
            @media (max-width: 1024px) {
                .grid.lg\\:grid-cols-2 {
                    grid-template-columns: 1fr;
                    gap: 2rem;
                }
            }
        `;
        document.head.appendChild(style);

        // Teacher Lesson Management Functions
        async function checkTeacherStatus() {
            try {
                const response = await fetch('php/check-user-type.php', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.user_type === 'teacher') {
                        showTeacherButton();
                        loadTeacherClasses();
                    }
                }
            } catch (error) {
                console.log('User is not a teacher or error checking status');
            }
        }

        function showTeacherButton() {
            const teacherBtn = document.getElementById('teacherManageBtn');
            if (teacherBtn) {
                teacherBtn.classList.remove('hidden');
            }
        }

        function showTeacherManagement() {
            const managementSection = document.getElementById('teacherLessonManagement');
            if (managementSection) {
                managementSection.classList.remove('hidden');
                managementSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function hideTeacherManagement() {
            const managementSection = document.getElementById('teacherLessonManagement');
            if (managementSection) {
                managementSection.classList.add('hidden');
            }
        }

        async function loadTeacherClasses() {
            try {
                const response = await fetch('php/get-teacher-classes.php', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.classes) {
                        populateTeacherClassSelector(result.classes);
                    }
                }
            } catch (error) {
                console.error('Error loading teacher classes:', error);
            }
        }

        function populateTeacherClassSelector(classes) {
            const selector = document.getElementById('teacherClassSelector');
            if (!selector) return;

            // Clear existing options except the first one
            selector.innerHTML = '<option value="">Choose a class...</option>';
            
            classes.forEach(classItem => {
                const option = document.createElement('option');
                option.value = classItem.id;
                option.textContent = `${classItem.class_name} (${classItem.student_count || 0} students)`;
                selector.appendChild(option);
            });
        }

        async function loadClassLessons() {
            const classId = document.getElementById('teacherClassSelector').value;
            if (!classId) {
                document.getElementById('lessonManagementContent').classList.add('hidden');
                return;
            }

            try {
                const response = await fetch(`php/topic-management.php?action=get_class_topics&class_id=${classId}`, {
                    credentials: 'include'
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.topics) {
                        displayClassLessons(result.topics);
                        document.getElementById('lessonManagementContent').classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error('Error loading class lessons:', error);
                Swal.fire({
                    title: 'Error',
                    text: 'Failed to load lessons for this class',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
        }

        function displayClassLessons(topics) {
            const container = document.getElementById('lessonsList');
            if (!container) return;

            if (topics.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-book-open text-3xl mb-2"></i>
                        <p>No lessons available for this class</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = topics.map(topic => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-book text-white"></i>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-900">${topic.topic_name}</h5>
                            <p class="text-sm text-gray-600">${topic.description || 'No description available'}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${topic.is_locked ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                            ${topic.is_locked ? 'Locked' : 'Unlocked'}
                        </span>
                        <button onclick="toggleLessonLock('${topic.topic_id}', ${topic.is_locked}, '${topic.class_id}')" 
                                class="px-4 py-2 rounded-lg text-sm font-medium transition-colors ${topic.is_locked ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-red-600 hover:bg-red-700 text-white'}">
                            <i class="fas ${topic.is_locked ? 'fa-unlock' : 'fa-lock'} mr-2"></i>
                            ${topic.is_locked ? 'Unlock' : 'Lock'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function toggleLessonLock(topicId, isLocked, classId) {
            try {
                const formData = new FormData();
                formData.append('action', 'toggle_topic_lock');
                formData.append('topic_id', topicId);
                formData.append('class_id', classId);
                formData.append('is_locked', isLocked);

                const response = await fetch('php/topic-management.php', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        Swal.fire({
                            title: 'Success',
                            text: result.message,
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        
                        // Reload lessons for the class
                        loadClassLessons();
                    } else {
                        Swal.fire({
                            title: 'Error',
                            text: result.message || 'Failed to update lesson lock status',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }
                }
            } catch (error) {
                console.error('Error toggling lesson lock:', error);
                Swal.fire({
                    title: 'Error',
                    text: 'An error occurred while updating lesson lock status',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
        }

        // Initialize teacher status check when page loads
        document.addEventListener('DOMContentLoaded', function() {
            checkTeacherStatus();
        });

        // Logout confirmation
        function confirmLogout(event) {
            event.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = 'php/smart-logout.php?type=student';
            }
        }
    </script>
</body>
</html>

